(()=>{var e="JA";var t=[null,null];var n=[null,null];const i=document.getElementById("shishiji-canvas");const o=i?.getContext("2d");var s=false;var a=1;const c=.65;const r={login:false,load:false};const d=400;const l={logined:false,sid:null,discriminator:null,data:{completed_orgs:[],profile:{}},pending_collects:[]};const u=[];const h=window.devicePixelRatio;const f=$.post(ajaxpath.eventd);const m=$.post(ajaxpath.banddel);const p=$.post(ajaxpath.progpt);const v=$.post(ajaxpath.specmsi);const g=new Promise((e=>e([1,2,3,4,5])))??$.post(ajaxpath.adv);var _=true;"touchstart mousedown".split(" ").forEach((e=>window.addEventListener(e,(()=>_=true),{passive:true})));const w={share:(...e)=>{},close:(...e)=>{},favorite:(...e)=>{},vote:(...e)=>{},evote:(...e)=>{}};const y={pkgo:false,article:false,main_screen:false};const E=[];const x=e=>E.push(e);var b=NaN;const T=document.createElement("canvas");const C=T.getContext("2d");var k=26;var L=false;const I=[];const A=function(e,t){if(typeof e!=="number"||typeof t!=="number")return I;else return I[e]?I[e][t]:null};T.canvas={coords:{x:0,y:0},rotation:0};const O={deny:false,scroll:1.05,object:{dynamic_to_static:{over:1.5,under:.3}},caps:{ratio:{max:6.5,min:.15}},touch:{downCD:1,zoomCD:-1,rotate:{min:5}},arrowkeys:{interval:5,move:3,ratio:1.005,nosprint:1.5,nosprintratio:1.0025}};const S=5;var R=0;var N={x:0,y:0,v:0,a:-75,method:null};var j={0:{x:0,y:0},1:{x:0,y:0},a:-150};var M=null;var D=null;var B={x:-1,y:-1,distance:-1};var H={};var X=0;var P=0;var G=false;var W=0;var F=0;var U=0;var Y=0;const q=["不明","すいている","やや混雑","混雑"];var J={};var z={deled:null,feels:[]};var V={};var K={};var Z=()=>{};var Q=1;var ee={middle:[],top:[]};var te=0;var ne=false;var ie;var oe={};var se="";const ae={fselector:{opened:false,colors:{current:"",else:""}}};const ce='<span class="gglmats">X</span>';const re={loadging:`<span class="gglmats loading-symbol">progress_activity</span>`,refresh:ce.replace("X","refresh"),height:ce.replace("X","height"),zoom_in:ce.replace("X","zoom_in"),zoom_out:ce.replace("X","zoom_out"),search:ce.replace("X","search"),arrow_upward:ce.replace("X","arrow_upward"),arrow_downward:ce.replace("X","arrow_downward")};const de={DO_NOTHING:0,CLOSE_ARTICLE:1,INIT_ZOOMRADIO:2,INIT_COORDS:3,INIT_FLOOR:4,DO_EVERYTHING:5};const le=de.DO_NOTHING;var ue="";var he=[];const fe=4;const me={ZOOM_RATIO:"x",COORDS:"@",ARTICLE_ID:"art",FLOOR:"fr",URL_FROM:"storm",LANGUAGE:"lang",SCROLL_POS:"scrp",ART_TARGET:"atg",LOGIN_DISCRIMINATOR:"glog",LOGIN_CONFIDENCE:"kry",JUMPTO:"jumpto"};const pe={FROM_ARTICLE_SHARE:"attsrh",FROM_NAVIGATE:"navigate"};const ve="disc-{0}";const ge=1.5;const _e=5;const we={description:()=>{},details:()=>{},commands:()=>{}};const ye={situation:{nickname:false,icon_path:false},saving:false};window.addEventListener("load",(()=>E.forEach((e=>e()))));function Ee(e,...t){for(const[n,i]of t.entries()){const t=new RegExp(`\\{${n}\\}`,"g");e=e.replace(t,i)}return e}function $e(e){return e*(Math.PI/180)}function xe(e){return e*(180/Math.PI)}function be(...e){var t=0;e.forEach((e=>{t+=e}));return t/e.length}function Te(e,t){return t(e)}function Ce(e){const t=e.getAttribute("coords")?.split(" ").map((e=>Number(e)));return{x:t[0],y:t[1]}}const ke={nextInt:function(e,t){if(e===undefined||t===undefined){if(e!=undefined){t=e;e=0}else{const e=Math.random();return e>.5?1:0}}return Math.floor(Math.random()*(t-e+1))+e},string:function(e){var t="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";const i=n.length;for(let o=0;o<e;o++){t+=n.charAt(Math.floor(Math.random()*i))}return t},randomChoice:function(e){return e[this.nextInt(0,e.length-1)]},shuffleArray(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}};function Le(e){return e.getAttribute("behavior")}function Ie(e){const t=e.getAttribute("dfsize")?.split(" ").map((e=>Number(e)));return{width:t[0],height:t[1]}}const Ae={advs:ke.shuffleArray([1,2,3,4,5]),current:1};async function Oe(e,t,n){const i=()=>{if(n){const e=Ae.current++;$t("map-top",e.toString());Gt.apply(self,[`/resources/img/advertisement/tfn-${Ae.advs[e]}.png`]);Ae.current>=Ae.advs.length?Ae.current=1:void 0}};if($("#load_spare").css("background-color")=="transparent")$("#load_spare").css("background-color","#15202b");clearTimeout(J.endloadtimeoutswhen);$("#theme-meta").attr("content","#15202b");$("#app-mount").show();$("#user-profile-opner").css("display","flex");$("#loaders").removeClass("bye");$("#load_spare").removeClass("loaddoneman").css("pointer-events","all").show();$("#greatblink").hide();if(t=="first"){$("#greatfrishmountain").addClass("Fdash");$("#greatblink").show().addClass("Ndash");$("#app-version").show();return new Promise(((e,t)=>{setTimeout((()=>{i();e()}),2090)}))}else{$("#map__opnner").show().removeClass("Ldash").addClass("Hdash");$("#greatfrishmountain").removeClass("Gdash Fdash").addClass("Jdash");$("#app-version").hide();return new Promise(((e,t)=>{setTimeout((()=>{i();e()}),250)}))}}function Se(e){const t=e.length;const n=Math.floor(Math.random()*t);return e[n]}function Re(e){}async function Ne(e,t){if(typeof Vn!=="undefined"&&await Vn())_t("1");return new Promise(((e,n)=>{function i(){$("#map__opnner").removeClass("Hdash").addClass("Ldash").show();$("#load_spare").css("background-color","transparent");setTimeout((()=>{$("#greatfrishmountain").addClass("Gdash");$("#greatblink").addClass("Bdash")}),100);setTimeout((()=>$("#loaders").addClass("bye")),500);setTimeout((()=>$("#load_spare").css("pointer-events","none")),750);J.endloadtimeoutswhen=setTimeout((()=>{clearInterval(J.load);$("#load_spare").hide();$("#theme-meta").attr("content","#15202b");$("#greatfrishmountain").removeClass("Gdash");e(void 0)}),1500)}setTimeout.call(window,i,t)}))}function je(e){var t=0;var n=0;if(e.length<1)return"";e="<mcft-cl>§p"+e;for(var i in MCColorList){var o=e.split("§".concat(i));t+=o.length-1;e=o.join('<mcft-cl style="color: '.concat(MCColorList[i],'">'))}for(var s in MCDec){var a="§".concat(s);while(e.includes(a)){var a="§".concat(s);n++;e=e.replace(a,"<mcft-dec ".concat(MCDec[s],">"));if(e.indexOf("§r")<e.indexOf(a)||e.indexOf(a)==-1){var c="";for(var r=0;r<=t;r++){c+="</mcft-cl>"}for(var r=-2;r<n;r++){c+="</mcft-dec>"}e=e.replace("§r",c);t=0;n=0}}}for(var r=0;r<=t;r++){e+="</mcft-cl>"}for(var r=0;r<n;r++){e+="</mcft-dec>"}return e}function Me(e,t,n){n??={};const i=n.arg1?n.arg1():void 0;const o=n.arg2?n.arg2():void 0;+function(){var s=0;var a=false;var c=false;function r(t,n){t.split(" ").forEach((t=>{e.addEventListener(t,n)}))}function d(e){s=0;a=true;e.preventDefault();if(n){if(n.forceLeft&&e.button&&e.button!=0)return}}function l(e){e.preventDefault();if(e instanceof TouchEvent&&e.touches.length>=2)c=true;s++}function u(e){e.preventDefault();if(s<=10&&a&&N.v<=1500&&!c)t.call(this,e,i,o);s=0;a=false;c=false}r("touchstart mousedown",d);r("touchmove mousemove wheel mousewheel",l);r("touchend mouseup mouseleave touchleave",u)}()}function De(e){e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/ /g,"&nbsp;");return e}function Be(e,t){const n=window.location.href;const i=new URLSearchParams(window.location.search);var o="";if(e==me.COORDS){if(i.toString()!=""){const e=Xe(me.ZOOM_RATIO);o=n.includes("@")?n.replace(/@.*/,"")+"@"+t+"x"+(e===null?1:e)+"?"+i.toString():n.replace(/\?.*/,"")+"@"+t+"?"+i.toString()}else{o=n+"@"+t}}else if(e==me.ZOOM_RATIO){if(i.toString()!=""){const e=Xe(me.COORDS);o=n.includes("@")?n.replace(/@.*/,"")+"@"+(e===null?"0,0":e)+"x"+t+"?"+i.toString():n.replace(/\?.*/,"")+"@"+t+"?"+i.toString()}else{o=n+"@"+Xe(me.COORDS)+t}}else{i.set(e,encodeURIComponent(String(t)));o=n.split("?")[0]+"?"+i.toString()}window.history.replaceState("","",o)}function He(e,t){const n=window.location.href;const i=new URLSearchParams(window.location.search);if(t)t=encodeURIComponent(t);i.delete(e,t);const o=n.split("?")[0]+"?"+i.toString();window.history.replaceState("","",o)}function Xe(e,t){if(t===void 0)t=window.location.href;if(e==me.COORDS){const e=/@([^?&]+)x([^?&]+)/;const i=/@([^?&]+)/;var n=t.match(e);if(!n)n=t.match(i);return n?n[1].replace(/x/g,""):null}else if(e==me.ZOOM_RATIO){const e=/@([^?&]+)x([^?&]+)/;const n=t.match(e);return n?n[2]:null}const i=new URLSearchParams(window.location.search);const o=i.get(e);return o?decodeURIComponent(o):null}function Pe(e){return V[e||""]}function Ge(e,t){const n=a*e;if(O.caps.ratio.max<n&&e>1){if(t)a=O.caps.ratio.max;return true}if(O.caps.ratio.min>n&&e<1){if(t)a=O.caps.ratio.min;return true}return false}function We(e){const t=document.cookie.split("; ");for(const n of t){const[t,i]=n.split("=");if(t===e){return decodeURIComponent(i)}}return null}function Fe(e){document.cookie=`${e}=; max-age=0;`}function Ue(e,t){window.localStorage.setItem(e,t)}function Ye(e){return window.localStorage.getItem(e)}function qe(e){window.localStorage.removeItem(e)}function Je(e,t){return"/resources/cloud/org/"+e+"/"+t}function ze(e,t){return"/resources/cloud/static/"+e+"/"+t}function Ve(e){return e.object.type.event==="org"?Je:ze}function Ke(){const e=navigator.language;return Ze(e)}function Ze(e){if(e)switch(e.toUpperCase()){case"JA":return"JA";default:return"EN"}else return null}function Qe(e){var t=e.split(".").slice(-1)[0].toLowerCase();if(["jpg","jpeg","png","gif","webp"].indexOf(t)!==-1){return"image"}if(["mp4","webm","avi","mov","flv"].indexOf(t)!==-1){return"video"}return"unknown"}class et{constructor(e,t){this.real=e;this.imag=t}add(e){return new et(this.real+e.real,this.imag+e.imag)}subtract(e){return new et(this.real-e.real,this.imag-e.imag)}multiply(e){return new et(this.real*e.real-this.imag*e.imag,this.real*e.imag+this.imag*e.real)}divide(e){const t=e.real*e.real+e.imag*e.imag;if(t===0){throw new Error("Division by zero")}return new et((this.real*e.real+this.imag*e.imag)/t,(this.imag*e.real-this.real*e.imag)/t)}rotate(e,t){t??=new et(0,0);const n=this.subtract(t);const i=Math.cos(e);const o=Math.sin(e);const s=new et(n.real*i-n.imag*o,n.real*o+n.imag*i);return s.add(t)}magnitude(){return Math.sqrt(this.real*this.real+this.imag*this.imag)}toString(){return`${this.real} + ${this.imag}i`}}function tt(e){const t=document.createElement("span");t.innerHTML=e;return t.textContent}function nt(e){$("#"+e).show().removeClass("calming recalming").addClass("activated").css("z-index",(++Q).toString());bt(e)}function it(e){$("#"+e).removeClass("activated").addClass("recalming");setTimeout((()=>$("#"+e).hide()),100);Q--}function ot(){$("shishiji-pks").removeClass("activated").addClass("recalming");Q=1}function st(e,t){["touchstart","mousedown"].forEach((n=>e.addEventListener(n,(function(n){var i=n instanceof TouchEvent?n.touches[0].clientY:n.clientY;var o=0;var s=false;function a(n){o=i-(n instanceof TouchEvent?n.touches[0].clientY:n.clientY);if(o>35&&!s){s=true;t(n);["touchmove","mousemove"].forEach((t=>e.removeEventListener(t,a,{passive:true})),{passive:true})}}["touchmove","mousemove"].forEach((t=>e.addEventListener(t,a,{passive:true})));["touchend","mouseup"].forEach((t=>e.addEventListener(t,(t=>{if(s){}["touchmove","mousemove"].forEach((t=>e.removeEventListener(t,a,{passive:true})),{passive:true});["touchmove","mousemove"].forEach((t=>e.removeEventListener(t,a)),{passive:true})}))))}),{passive:true})))}function at(e,t){switch(t){case"top":ee.top.length==0?$("#topestLoadMan").removeClass("aOKSGD"):void 0;ee.top.push(e);break;case"middle":ee.top.length==0?$("#midestLoadMan").removeClass("aOKSGD"):void 0;ee.middle.push(e);break}}function ct(e,t){switch(t){case"top":ee.top=ee.top.filter((t=>t!==e));ee.top.length==0?$("#topestLoadMan").addClass("aOKSGD"):void 0;break;case"middle":ee.middle=ee.middle.filter((t=>t!==e));ee.middle.length==0?$("#midestLoadMan").addClass("aOKSGD"):void 0;break}}function rt(e){if(!e.startsWith("data:")){throw new Error("Invalid Data URL")}const[t,n]=e.split(",");const i=t.match(/:(.*?);/)?.[1];const o=atob(n);const s=o.length;const a=new Uint8Array(s);for(let e=0;e<s;e++){a[e]=o.charCodeAt(e)}return new Blob([a],{type:i})}function dt(e,t){var n="url("+e;n+=t?"?"+ke.string(8):"";n+=")";return n}function lt(e,t){if(e.length!==t.length)return false;var n=e.slice().sort();var i=t.slice().sort();for(let e=0;e<n.length;e++){if(n[e]!==i[e]){return false}}return true}function ut(e,t){const n=[];for(const[i,o]of Object.entries(V)){if(o.object.floor==e&&o.article){if(t){if(o.object.no_admission)continue}n.push(i)}}return n}function ht(e){return l.data.completed_orgs.includes(e)}function ft(e,t){const n=document.createElement("tr");n.classList.add("ev_property");const i=document.createElement("th");i.textContent=e;i.classList.add("ev_property_cell");const o=document.createElement("th");o.textContent=t;o.classList.add("ev_property_cell");n.appendChild(i);n.appendChild(o);return n}function mt(){$("#mission_progress_bar").css("width",(l.data.pt/5e4*100).toString()+"%");$("#user-total-points").text(l.data.pt+"pt");$("#smartestppl").text(l.data.pt+"pt");$("#profile-totalscore").text(l.data.pt+"pt");const e=[...ptmedal];for(const t of e.reverse()){if(l.data.pt>=t.pt){$("#dashub, #user-rank").css("background-image",`url(${pt(l.data.pt)})`);break}}const t=vt(l.data.pt);if(!t){const e=ptmedal[0].pt;$("#rank-progress").css("width",`${l.data.pt/e*100}%`)}else if(!t[1]){$("#rank-progress").css("width",`100%`)}else{const e=Math.abs(t[1].pt-t[0].pt);const n=l.data.pt-t[0].pt;const i=n/e*100;$("#rank-progress").css("width",`${i}%`)}}function pt(e){const t=[...ptmedal];for(const n of t.reverse()){if(e>=n.pt){return n.src}}}function vt(e){const t=[...ptmedal];for(var n=t.length-1;n>=0;n--){const i=t[n];if(e>=i.pt){return[i,t[n+1]]}}}function gt(e){const t=document.createElement("div");const n=document.createElement("div");const i=document.createElement("p");i.textContent=`+${e}`;n.classList.add("aOBvjw");t.classList.add("uihagod");n.appendChild(i);t.appendChild(n);$("shishiji-pt-claimer").append(t);setTimeout((()=>{t.classList.add("haveaniceday");setTimeout((()=>t.remove()),500)}),5*1e3+500)}function _t(e){const t=document.getElementById("pkgo_menu"+e)?.children[0];t?.querySelectorAll("menu-notifier").forEach((e=>e.remove()));t?.appendChild(document.createElement("menu-notifier"))}function wt(e){const t=document.getElementById("pkgo_menu"+e)?.children[0];t?.querySelectorAll("menu-notifier").forEach((e=>e.remove()))}function yt(e){const t=Ye("__tour-"+e);return!Boolean(t)}function Et(e){const t=Bt[e];if(t){t.start();Ue("__tour-"+e,"done-"+(new Date).toString())}}function $t(e,t){$.post(ajaxpath.collectad,{f:"adv",b:e,d:t})}function xt(e,t){$.post(ajaxpath.collectad,{f:e,v:t})}function bt(e){for(const t of l.pending_collects){if(t.name==e)t.count++;return}l.pending_collects.push({name:e,count:1})}function Tt(e,t){const n=document.createElement("span");e.appendChild(n);n.innerHTML=t;n.classList.add("MCOBF","crucial")}function Ct(e,t){const n=t.length;const i=document.createElement("span");var o=false;for(var s=0;s<n;s++){const n=MCSTYLES[t[s]];if(typeof n!=="string")continue;i.style.cssText+=n+";";if(t[s]==="§k"){Tt(i,e);o=true}}if(!o)i.innerHTML=e;return i}function kt(e){e=e.replace(/§h/g,'<hr class="article-dv">');var t=e.match(/§.{1}/g)||[],n=[],i=[],o,s,a=document.createDocumentFragment(),c=t.length,e=e.replace(/\n|\\n/g,"<br>");for(var r=0;r<c;r++){n.push(e.indexOf(t[r]));e=e.replace(t[r],"\0\0")}if(n[0]!==0){a.appendChild(Ct(e.substring(0,n[0]),[]))}for(var r=0;r<c;r++){s=n[r+1]-n[r];if(s===2){while(s===2){i.push(t[r]);r++;s=n[r+1]-n[r]}i.push(t[r])}else{i.push(t[r])}if(i.lastIndexOf("§r")>-1){i=i.slice(i.lastIndexOf("§r")+1)}o=e.substring(n[r],n[r+1]);a.appendChild(Ct(o,i))}return a}async function Lt(e){try{const t=await fetch(e);return await t.blob()}catch(e){return null}}function It(e,t){e=De(e);e=e.replace(/\n/g,"").replace(/§v/g,"\n");var n="";const i=kt(e);for(var o of Array.from(i.children)){n+=o.outerHTML}const s=/∫\:IMG-S=([^-]+)-W=(\d+);∫/g;const a=/∫\:VIDEO-S=([^-]+)-W=(\d+);∫/g;const c=/#\:LINK-H=(https?:\/\/(?:(?!-T=).)+)-T=((?:(?!;#).)*);#/g;const r=n.matchAll(s)||[];const d=n.matchAll(a)||[];const l=n.matchAll(c)||[];for(const e of r){const i=Number(e[2]);n=n.replace(e[0],`<img class="article-image doaJSD protected" loading="lazy" draggable="false" src="${t(e[1])}" style="width: ${i>100||i<0?100:i}%;">`)}for(const e of d){const i=Number(e[2]);n=n.replace(e[0],`<video class="article-video protected" loading="lazy" draggable="false" src="${t(e[1])}" controls preload="metadata" playsinline style="width: ${i>100||i<0?100:i}%;"></video>`)}for(const e of l){const t=e[1];n=n.replace(e[0],`<a class="article-outsidelink notprotected" draggable="true" href="${new URL(t)}" target="_blank">${e[2].length>0?e[2]:e[1]}</a>`)}return n}!function(){const e="123456789abcdefghijklmnopqrstuvwxyz";const t=e.split("").concat(e.slice(9).toUpperCase().split(""));setInterval((function(){const e=document.getElementsByClassName("MCOBF");for(const i of e){for(const e of i.childNodes){var n="";if(e.textContent==null)continue;for(const i of e.textContent.split("")){const e=Math.round(Math.random()*(t.length-1));n+=t[e]}e.textContent=n}}}),10);return 0}();var At=[];!function(){var e,t;document.documentElement.addEventListener("mousemove",(function(e){N.method="MOUSE";t=e}));At.push((function(){var n=0;var i=0;var o=0;if(e&&t){var n=t.screenX-e.screenX;var i=t.screenY-e.screenY;var o=Math.sqrt(n*n+i*i)}e=t;if(N.method=="MOUSE"){N.x=100*n;N.y=100*i;N.v=100*o}}));return 0}();!function(){var e=0;var t;function n(e){var t=0;var n=0;for(var i of e){t+=i.clientX;n+=i.clientY}t/=e.length;n/=e.length;return{x:t,y:n}}var i,o;document.documentElement.addEventListener("touchmove",(function(e){N.method="TOUCH";o=e}));At.push((function(){var s=0;var a=0;var c=0;if(o&&o.touches.length>=2){e=1;if(t)clearTimeout(t);t=setTimeout((()=>{e=0}),250)}if(i&&o&&o.touches.length==1&&e===0){var r=n(o.touches),d=n(i.touches);s=r.x-d.x;a=r.y-d.y;c=Math.sqrt(s*s+a*a)}i=o;if(N.method=="TOUCH"){N.x=100*s;N.y=100*a;N.v=100*c}}));return 0}();!function(){var e;function t(e){var t=0;var n=0;for(var i of e){t+=i.clientX;n+=i.clientY}t/=e.length;n/=e.length;return{x:t,y:n}}var n,i;document.documentElement.addEventListener("touchmove",(function(e){N.method="TOUCH";i=e}));At.push((function(){var e={0:{x:0,y:0},1:{x:0,y:0}};if(!i&&!n||i.touches.length==1)return;if(n&&i&&i.touches.length==1){for(var t=0;t<2;t++){var o=i.touches[t];var s=n.touches[t];e[t].x=o.clientX-s.clientX;e[t].y=o.clientY-s.clientY}}n=i;if(N.method=="TOUCH"){for(var t=0;t<2;t++){j[t].x=100*e[t].x;j[t].y=100*e[t].y}}}));return 0}();setInterval((()=>At.forEach((e=>e()))),20);function Ot(e){e.preventDefault()}window.addEventListener("gesturestart",Ot,{passive:false});window.addEventListener("dblclick",Ot,{passive:false});window.addEventListener("wheel",(function(e){if(e.ctrlKey||e.metaKey)e.preventDefault()}),{passive:false});const St=io.connect(void 0,{withCredentials:true});St.on("user.admission.pending",(e=>{at(e.s+"-admission-pending","middle")}));St.on("user.admission.register",(async t=>{const n=Pe(t._new);const i=n?t.processType:"unknown";switch(i){case"duplicated":_o.notifyWarn(TEXTS[e].ALREADY_VISITED,{duration:1e4});break;case"included":const i=t._pt;l.data.completed_orgs=t._update;l.data.pt=t._apt;Fi();_o.notifySuccess(Ee(TEXTS[e].ADMISSION_RECORDED,n?.article.title),{duration:1e4});gt(`${i}pt`);if(await Vn()){_t("1")}break;default:_o.notifyError(TEXTS[e].UNKNOWN_ERROR,{duration:1e4})}mt();setTimeout((()=>ct(t._new+"-admission-pending","middle")),500)}));St.on("user.ticket.consumption",(async t=>{const n=t._newtickets;const i=t.used;_o.notifySuccess(Ee(TEXTS[e].TICKET_USED,i.visual.description),{duration:10*1e3,deny_userclose:true,do_not_keep_previous:true});it("ticket_use_screen");l.data.tickets=n;Mn()}));const Rt=[];var Nt=false;function jt(e){if(Nt)e();else Rt.push(e)}const Mt=new Promise((async function(t){$.ajax({url:ajaxpath.integrity,type:"POST",success:function(t){Nt=true;l.logined=true;l.discriminator=t.discriminator;const n=JSON.parse(t.completed_orgs);const i=JSON.parse(t.profile);const o=JSON.parse(t.fame_votes);const s=JSON.parse(t.band_votes);const a=JSON.parse(t.dance_votes);const c=JSON.parse(t.misc_votes);const r=JSON.parse(t.favorited_orgs);const d=JSON.parse(t.claimed_rpt);const u=JSON.parse(t.custom_data);const h=JSON.parse(t.tickets);l.data.completed_orgs=n;l.data.profile=i;l.data.fame_votes=o;l.data.band_votes=s;l.data.dance_votes=a;l.data.misc_votes=c;l.data.favorited_orgs=r;l.data.pt=Number(t.pt);l.data.claimed_rpt=d;l.data.tickets=h;l.data.custom_data=u;l.data.isstudent=t.isstudent;$("#user-name-input").val(l.data.profile.nickname);$("#user-name").text(l.data.profile.nickname);mt();l.data.profile.icon_path?$("#user-icon, #user-icon-change").css("background-image",dt(l.data.profile.icon_path,true)):void 0;if(l.data.isstudent)$("#pkgo_menu2、#pkgo_menu1").remove();if(Xe("dev")!="setagaquest")$("#pkgo_menu6").remove();_o.notify("success",Ee(TEXTS[e].LOGINED,t.discriminator),{addToPending:true});Rt.forEach((e=>e()))},error:function(e){x((()=>_o.notify("warn","Login Failed")));at("integrity","top")},complete:function(){ct("integrity","top");r.login=true;t(void 0)}});setTimeout((()=>{if(!Nt)at("integrity","top")}),2500)}));setInterval((async function(){St.emit("org.data.crowdstatus",(function(e){for(const n in e){if(!V[n])continue;var t=e[n];V[n].article.crowd_status=t;Ki(n,t);if(t==0)t=1;$("#sstatus-disc-"+n).removeClass("n1 n2 n3 n0").addClass("n"+t.toString())}}))}),15*1e3);function Dt(){var t=false;return new Promise((n=>{nt("headcount_screen");function i(){const o=Number($("#headcount_select").val());const s=Number($("#generation_select").val())||null;const a=Number($("#gender_select").val())||null;const c=structuredClone(l.data.custom_data);c["headcount"]=o;s?c["generation"]=s:0;a?c["gender"]=a:0;if(t)return;t=true;$.post(ajaxpath.setcustom,{customs:JSON.stringify(c)}).then((function(){l.data.custom_data=structuredClone(c);_o.notifySuccess(TEXTS[e].THANKS_FOR_COOPERATING);document.getElementById("setupheadcount")?.removeEventListener("click",i);it("headcount_screen");n(void 0)})).catch((()=>{_o.notifyError(TEXTS[e].ERROR_ANY);t=false}))}document.getElementById("setupheadcount")?.addEventListener("click",i)}))}const Bt={main_screen:new Shepherd.Tour({defaultStepOptions:{classes:"shepherd-theme-arrows",scrollTo:false}}),menu:new Shepherd.Tour({defaultStepOptions:{classes:"shepherd-theme-arrows",scrollTo:false}}),ranking:new Shepherd.Tour({defaultStepOptions:{classes:"shepherd-theme-arrows",scrollTo:false}}),article:new Shepherd.Tour({defaultStepOptions:{classes:"shepherd-theme-arrows",scrollTo:false}})};const Ht={main_screen:[{title:"階切り替え",text:"閲覧する階を変更できます",attachTo:{element:"#fsel-xxl",on:"left"},buttons:[{text:"次へ",action:Bt.main_screen.next}]},{title:"団体",text:"タップするとこの場所にある団体の情報を確認できます",attachTo:{element:"#disc-swimming",on:"right"},buttons:[{text:"戻る",action:Bt.main_screen.back},{text:"次へ",action:Bt.main_screen.next}]},{title:"プロフィール",text:"ランキングに載るプロフィールを変更できます(アイコン, ニックネーム)",attachTo:{element:"#user-profile-opner",on:"top-end"},buttons:[{text:"戻る",action:Bt.main_screen.back},{text:"次へ",action:Bt.main_screen.next}]},{title:"メニュー",text:"タップするとほかのさまざまな機能をご利用いただけます",attachTo:{element:"#pkgo_mainb",on:"top"},buttons:[{text:"戻る",action:Bt.main_screen.back},{text:"了解",action:()=>{y.main_screen=O.deny=false;Bt.main_screen.next()}}]}],menu:[{title:"QRコード",text:"入場記録, スタンプラリーに使用し、ポイントを獲得できます",attachTo:{element:"#qrcodebuttonman",on:"top"},buttons:[{text:"次へ",action:Bt.menu.next}]},{title:"ミッション",text:"ミッションを達成するとポイントをもらえます(団体に入室された時にもらえるポイントと同じです)。\n獲得したポイントでチケットを獲得できます",attachTo:{element:"#pkgo_menu1 > div",on:"top"},buttons:[{text:"戻る",action:Bt.menu.back},{text:"次へ",action:Bt.menu.next}]},{title:"チケット",text:"ミッションで獲得したチケットで景品交換ができます",attachTo:{element:"#ticketsbuttonman",on:"top"},buttons:[{text:"戻る",action:Bt.menu.back},{text:"次へ",action:Bt.menu.next}]},{title:"イベント",text:"バンドやダンスなどのイベントスケジュールをご確認いただけます",attachTo:{element:"#pkgo_menu3 > div",on:"top"},buttons:[{text:"戻る",action:Bt.menu.back},{text:"次へ",action:Bt.menu.next}]},{title:"展示団体",text:"マップに表示されているアイコンの一覧や検索ができます",attachTo:{element:"#pkgo_menu5 > div",on:"top"},buttons:[{text:"戻る",action:Bt.menu.back},{text:"次へ",action:Bt.menu.next}]},{title:"人気投票",text:"イベントや、訪れた団体に人気投票することができます",attachTo:{element:"#pkgo_menu2 > div",on:"top"},buttons:[{text:"戻る",action:Bt.menu.back},{text:"次へ",action:Bt.menu.next}]},{title:"グッズ紹介",text:"獅子児祭グッズを紹介します",attachTo:{element:"#pkgo_menu4 > div",on:"top"},buttons:[{text:"戻る",action:Bt.menu.back},{text:"次へ",action:Bt.menu.next}]},{title:"飲食",text:"獅子児祭での飲食店の一覧をご覧いただけます",attachTo:{element:"#pkgo_menu7 > div",on:"bottom"},buttons:[{text:"戻る",action:Bt.menu.back},{text:"終わる",action:()=>{Bt.menu.next();y.pkgo=false}}]}],ranking:[{title:"ランキング",text:"ミッションptの上位100人が表示されます（それだけです）",attachTo:{element:"#go_to_ranking",on:"left-start"},buttons:[{text:"終わる",action:()=>{Bt.ranking.next();y.pkgo=false}}]}],article:[{title:"お気に入り",text:"登録されるとそのアイコンの左下に印が付きます。投票などでの絞り込みにもご活用いただけます",attachTo:{element:"#dvd2",on:"bottom"},buttons:[{text:"次へ",action:Bt.article.next}]},{title:"投票",text:"訪れた（入場記録をとった）団体には人気投票ができます",attachTo:{element:"#dvd3",on:"bottom"},buttons:[{text:"戻る",action:Bt.article.back},{text:"次へ",action:Bt.article.next}]},{title:"詳細",text:"団体の詳細情報",attachTo:{element:"#ovv-t-details-sd",on:"bottom"},buttons:[{text:"戻る",action:Bt.article.back},{text:"次へ",action:()=>{$("#ovv-t-details-sd").trigger("click");setTimeout(Bt.article.next,50)}}]},{title:"訪問pt",text:"入場記録をとった際に<br>獲得できるミッションptです<br>混雑状況によって変化します",attachTo:{element:".ev_property",on:"bottom"},buttons:[{text:"戻る",action:()=>{$("#ovv-t-description-sd").trigger("click");setTimeout(Bt.article.back,50)}},{text:"終わる",action:()=>{Bt.article.next();y.article=false}}]}]};+function(){for(const[e,t]of Object.entries(Ht)){const n=Bt[e];t.forEach((e=>n.addStep(e)))}}();function Xt(e){const t=document.createElement("div");t.classList.add("LXId");t.innerHTML=`\n            <div class="uhbAJw" style="background-image:url(/resources/img/advertisement/tfn-${e}.png)">\n    \n            </div>\n        `;return t}function Pt(e){if(e.target?.id=="top-advertisement-img")return;$("shishiji-fking-advertisement").addClass("hidden-adv")}function Gt(e){$("#top-advertisement-img").attr("src",e);$("shishiji-fking-advertisement").removeClass("hidden-adv")}function Wt(){nt("search_screen");$("#ovie_search_boxw").removeClass("closeL").addClass("openH");if(!$("#search_result").hasClass("searchen")){$("#search_result").empty().off("scroll",Ut).addClass("searchen");Vt(true)}else{qt()}}function Ft(){$("#ovie_search_boxw").removeClass("openH").addClass("closeL");$("#oive_a").removeClass("hello").addClass("bye_cry").show()}async function Ut(){return;$(".ABId.wwwnotwith").each((function(){var e=this.offsetTop;var t=$("#search_result").scrollTop()||0;var n=window.innerHeight;if(e-t<n){const e=$(this).find(".notwithdetails");const t=e.attr("disc")||"";this.classList.remove("wwwnotwith");e.removeClass("notwithdetails");(function n(){function i(){$.post(ajaxpath.getart+"?discriminator="+t,{}).then((t=>{e.html(tt(tt(It(t.article,(()=>""))))||"詳細を確認できませんでした。")})).fail(i)}i()})()}}))}var Yt=new Promise((e=>e(null)));async function qt(){var e=await Yt;if(e==null){e=Yt=$.post(ajaxpath.getallart);e=await e;setTimeout((()=>Yt=new Promise((e=>e(null)))),5e3)}function t(){var t={};for(const n in e.article){t[n]=tt(It(e.article[n]||"",(()=>"")))}window.navigator.clipboard.writeText(JSON.stringify(t,null,4))}$(".ABId.wwwnotwith").each((function(){const t=$(this).find(".notwithdetails");const n=t.attr("disc")||"";t.html(tt(tt(It(e.article[n]||"",(()=>""))))||"詳細を確認できませんでした。");var i=Number(e.crowd[n]);i=i==0?1:i;$("#sstatus-disc-"+n).removeClass("n1 n2 n3 n0").addClass(`n${i}`)}))}function Jt(){const e=$("#fav_search").attr("fav_search");if(e){$(".holdmeLikeThat").each((function(e){if(!l.data.favorited_orgs.includes(this.getAttribute("disc")||""))this.style.display="none"}))}else{$(".holdmeLikeThat").show()}$(".LXId").remove();Kt()}function zt(e){const t={};Vt(false);$("#search_result").children().each((function(){const e=this.getAttribute("disc");if(!e)return;t[e]=this}));$("#search_result").empty();for(const n of e){$("#search_result").append(t[n])}$("#search_result").trigger("scroll");Jt()}function Vt(t){const n=document.getElementById("search_result");const i=$("#fav_search").attr("fav_search");var o=true;$("#search_result").empty().scrollTop(0);for(const[e,t]of Object.entries(V)){if(i&&!l.data.favorited_orgs.includes(e))continue;if(t.article){const e=document.createElement("div");e.appendChild(Zt(t));const i=e.children[0];i.addEventListener("click",(function(){Be(me.ARTICLE_ID,t.discriminator);so();lo(t,true,void 0,void 0,void 0,true)}));n.appendChild(i);o=false}}Kt();$("#search_result").trigger("scroll");qt();if(i&&o){const t=document.createElement("span");t.classList.add("iuhagW","UghaWW");t.textContent=TEXTS[e].HOW_TO_FAV;$("#search_result").append(t);return}}function Kt(){const e=$('.holdmeLikeThat:not([style*="display: none"])').length;const t=[];g.then((n=>{n=ke.shuffleArray(n);const i=n.length;const o=Math.floor(e/n.length);if(o<4){n=n.slice(0,Math.floor(e/4))}if(o==0)return;for(var s=o;s<e;s=s+o){const e=Math.floor(s/o)-1;$(".holdmeLikeThat").eq(s).after(Xt(n[e]));t.push(e)}$t("search-screen",t.join(" "))}))}function Zt(e){const t=Ve(e);const n={"1F":"1階","2F":"2階","3F":"3階","4F":"4階"};const i=document.createElement("div");i.classList.add("ABId","wwwnotwith","holdmeLikeThat");i.setAttribute("disc",e.discriminator);const o=document.createElement("div");o.classList.add("BIfff");const s=document.createElement("div");s.classList.add("IcoNium");const a=document.createElement("div");a.classList.add("haVUn");a.id="sstatus-disc-"+e.discriminator;const c=document.createElement("img");c.src=t(e.discriminator,e.object.images.icon);s.appendChild(c);s.appendChild(a);const r=document.createElement("h2");r.textContent=e.article.title;o.appendChild(s);o.appendChild(r);const d=document.createElement("h4");d.classList.add("auygsWU");d.textContent=`${n[e.object.floor]}${e.article.venue?", "+e.article.venue:""}`;const l=document.createElement("div");l.classList.add("AINBU");const u=document.createElement("h3");u.classList.add("smlTtl");u.textContent=e.article.subtitle||"";const h=document.createElement("div");h.classList.add("EZdes");const f=document.createElement("span");f.classList.add("janS","notwithdetails");f.setAttribute("disc",e.discriminator);h.appendChild(f);l.appendChild(u);l.appendChild(h);i.appendChild(o);i.appendChild(d);i.appendChild(l);return i}function Qt(){const t=$("#org_search_input").val();if(ee.middle.includes("search mapobject")||!t)return;at("search mapobject","middle");$.ajax({url:ajaxpath.search+`?q=${$("#org_search_input").val()}`,type:"post",contentType:"application/json",data:JSON.stringify({query:t}),crossDomain:true}).then((e=>{zt(e);ct("search mapobject","middle")})).catch((()=>_o.notifyError(TEXTS[e].ERROR_ANY))).always((()=>ct("search mapobject","middle")))}function en(){nt("faq_screen")}const tn=[];function nn(){nt("stamp_rally_scan_screen");at("opening camera","middle");if(!("mediaDevices"in navigator&&"getUserMedia"in navigator.mediaDevices))_o.notifyError(TEXTS[e].BROWSER_DOESNT_HAVE_CAMERA_FUNC);else setTimeout((async()=>{const t=document.getElementById("qrcode-video");const n=document.getElementById("camera-canvas");const i=n.getContext("2d");const o=document.getElementById("rect-canvas");const s=o.getContext("2d");const a=e=>{on(e);$("#close_button_of_stamp_rally_scan_screen").trigger("click")};const c=e=>{o.width=u;o.height=h;r(e.topLeftCorner,e.topRightCorner);r(e.topRightCorner,e.bottomRightCorner);r(e.bottomRightCorner,e.bottomLeftCorner);r(e.bottomLeftCorner,e.topLeftCorner)};const r=(e,t)=>{s.lineWidth=4;s.strokeStyle="#50C878";s.beginPath();s.moveTo(e.x,e.y);s.lineTo(t.x,t.y);s.stroke()};const d=()=>{n.width=u;n.height=h;i.drawImage(t,0,0,u,h);requestAnimationFrame(d)};const l=async()=>{const e=i.getImageData(0,0,u,h);const t=jsQR(e.data,u,h);if(t&&t.data){c(t.location);at("stamp code read","middle");setTimeout((()=>{a(t.data);ct("stamp code read","middle");i.clearRect(0,0,n.width,n.height);s.clearRect(0,0,o.width,o.height)}),490);return}else{s.clearRect(0,0,u,h)}setTimeout((()=>{l()}),500)};var u;var h;const f=navigator.mediaDevices.getUserMedia({audio:false,video:{width:screen.height,height:screen.width,facingMode:{exact:"environment"}}}).then((e=>{tn.push(e);t.srcObject=e;t.onloadeddata=()=>{t.play();u=t.clientWidth;h=t.clientHeight;d();l();if(!ee.middle.includes("opening camera")){e.getTracks().forEach((e=>e.stop()))}else{ct("opening camera","middle")}}})).catch((t=>{var n="";switch(t.toString()){case"OverconstrainedError":case"NotFoundError":n="CAMERA_NOT_FOUND";break;case"NotReadableError":n="SYSTEM_ERROR";break;case"TypeError":n="UNKNOWN_ERROR";break;case"SecurityError":default:n="PLEASE_ALLOW_CAMERA";break}_o.notifyError(TEXTS[e][n],{discriminator:"camera error",do_not_keep_previous:true});it("stamp_rally_scan_screen");ct("opening camera","middle")}))}),250)}function on(e){nt("stamp_rally_scanned_screen");$("#uhgaiaSafs").text(e)}function sn(){nt("myqrcode_screen");$("#myqrcode").attr("src","");$.post(ajaxpath.mqr).then((e=>{const t=rt(e);$("#myqrcode").attr("src",URL.createObjectURL(t))})).catch((t=>{_o.notifyError(TEXTS[e].ERROR_LOADING_QRCODE)}))}class an{static oepn(e){$("#pkgo_menu_closeAWW").removeClass("oAIKSD");$("#pkgo_mainb").css({"pointer-events":"none",visibility:"hidden"});$("#pkgo_menu_close").removeClass("imdisplaynone iiasdIOJAGDjafjiofjoijaoijs").addClass("iiasdIOJ");$(".pkgo_menu_insidew").removeClass("oafs");$(".pok_anom").removeClass("imdisplaynone aUDGJHJSduijujaijuigsdjuio").addClass("opening_yey");$("pokemon-gradient").removeClass("aggjg").addClass("uiagg");$("#pkgo_menu_OPEN_RETAINER").removeClass("gauhi8yS");$("spreads").removeClass("AUHISGFjjj");$(".pkm__h").addClass("AIOSJ");$("#theme-meta").attr("content","#4b4f52")}static close(e){$("#pkgo_menu_closeAWW").addClass("oAIKSD");$("#pkgo_mainb").css({"pointer-events":"all",visibility:"visible"});$("#pkgo_menu_close").removeClass("iiasdIOJ").addClass("iiasdIOJAGDjafjiofjoijaoijs");$(".pkgo_menu_insidew").addClass("oafs");$(".pok_anom").removeClass("opening_yey").addClass("aUDGJHJSduijujaijuigsdjuio");$("pokemon-gradient").removeClass("uiagg").addClass("aggjg");$("#pkgo_menu_OPEN_RETAINER").addClass("gauhi8yS");$("#theme-meta").attr("content","#15202b")}static get opened(){return!$("#pkgo_menu_closeAWW").hasClass("oAIKSD")}}function cn(e){e.preventDefault();an.close()}function rn(){const e=$(this).find("spreads");setTimeout((()=>e.addClass("AUHISGFjjj")),1);e.removeClass("AUHISGFjjj")}function dn(){if(y.main_screen)return;nt("profile_screen")}function ln(){if(!this.files){_o.notifyError(TEXTS[e].ERROR_ANY);return}const t=this.files[0];const n=URL.createObjectURL(t);$("#user-icon-change").css("background-image","url("+n+")");ye.situation.icon_path=true}async function un(){const t=document.getElementById("chiconinputimgae")?.files;const n=document.getElementById("user-name-input")?.value.replace(/^\s+/,"")||"";var i=null;const o=function(){ye.saving=false;_o.notifyError(TEXTS[e].ERROR_ANY)};if(Object.values(ye.situation).every((e=>!e))||ye.saving)return;if(!n){_o.notifyError(TEXTS[e].NICKNAME_CANT_BE_EMPTY);return}else if(n.length>12){_o.notifyError(TEXTS[e].NICKNAME_TOO_LONG);return}const s=e=>new Promise(((t,n)=>{const i=new FileReader;i.onload=function(i){const o=new Image;o.src=i.target.result;o.onload=function(){const i=document.createElement("canvas");const s=i.getContext("2d");let a=o.width;let c=o.height;if(a>c){if(a>256){c=c*(256/a);a=256}}else{if(c>256){a=a*(256/c);c=256}}i.width=a;i.height=c;s?.drawImage(o,0,0,a,c);i.toBlob((function(i){if(i){const n=new File([i],e.name,{type:e.type});t(n)}else{n(new Error)}}),e.type||"image/png")};o.onerror=function(){n(new Error)}};i.readAsDataURL(e)}));if(t&&t[0]){i=t[0];try{i=await s(i)}catch(e){o();return}}const a=new FormData;a.append("file",i);a.append("nickname",n);ye.saving=true;at("profile-saver","top");$.ajax({url:ajaxpath.profileupd,type:"POST",data:a,processData:false,contentType:false}).done((t=>{ye.saving=ye.situation.icon_path=ye.situation.nickname=false;l.data.profile.nickname=t.nickname;l.data.profile.icon_path=t.icon_path;$("#user-name-input").val(l.data.profile.nickname);$("#user-name").text(l.data.profile.nickname);l.data.profile.icon_path?$("#user-icon, #user-icon-change").css("background-image",dt(l.data.profile.icon_path,true)):void 0;_o.notifySave(TEXTS[e].PROFILE_SAVED,{do_not_keep_previous:true})})).fail(o).always((()=>ct("profile-saver","top")))}var hn=[];function fn(){nt("vote_screen")}function mn(e){const t=document.getElementById("aiUHGG");nt("fame_vote_screen");t?.classList.remove("faui");$(t?.children[0]?.children[0]).show();$(t?.children[0].children[1]).hide();t?.removeAttribute("stricted");pn(e)}function pn(t){const n=l.data.completed_orgs;const i=[...l.data.fame_votes];var o=null;hn=[...l.data.fame_votes];hn=t?t:hn;const s=t?.[0]||hn[0]||"";$("#dumn_heres_new_way > .CDId, .iuhagW").remove();$("#dumn_heres_new_way").scrollTop(0);for(const e of n){const t=Pe(e);if(t&&t.article){const n=vn(t,hn.includes(e),i.includes(e));if(t.discriminator==s)o=n;$("#dumn_heres_new_way").append(n)}}$("#vote_right_now").hide();gn(true);const a=(o?.offsetTop||0)-window.innerHeight/2+100+40.5;$("#dumn_heres_new_way").scrollTop(a);if(n.length==0){const t=document.createElement("span");t.classList.add("iuhagW");t.textContent=TEXTS[e].HOW_TO_FAME_VOTE;$("#dumn_heres_new_way").append(t)}}function vn(e,t,n){const i=document.createElement("div");const o=document.createElement("div");o.classList.add("CDId");const s=document.createElement("div");s.classList.add("GGId");s.setAttribute("duty",e.discriminator);const a=document.createElement("div");a.classList.add("BIfff");const c=document.createElement("div");c.classList.add("AUYHs");const r=document.createElement("div");r.classList.add("IcoNium");const d=document.createElement("img");d.src=Je(e.discriminator,e.object.images.icon);const l=document.createElement("h2");l.textContent=e.article.title;r.appendChild(d);a.appendChild(r);a.appendChild(l);s.appendChild(a);s.appendChild(c);o.appendChild(s);i.classList.add("asujwaGTGg","manyyearshaspassed");o.appendChild(i);i.addEventListener("click",(function(){Be(me.ARTICLE_ID,e.discriminator);so();lo(e,true,void 0,void 0,void 0,true)}));s.addEventListener("click",(function(){const e=this.getAttribute("duty")||"";const t=this;hn.includes(e)?+function(){hn=hn.filter((t=>t!==e));hn=[];$(".GGId").removeClass("imselected");t.classList.remove("imselected")}():+function(){hn.push(e);hn=[e];$(".GGId").removeClass("imselected");t.classList.add("imselected")}();gn()}));if(t)s.classList.add("imselected");if(n)s.classList.add("imcurrentleader");return o}function gn(e){e?void 0:$("#vote_right_now").show();lt(hn,l.data.fame_votes)?$("#vote_right_now").removeClass("imhere").addClass("imbye"):+function(){$("#vote_right_now").removeClass("imbye").addClass("imhere");$("#vote_right_now").show()}()}function _n(){const e=this.getAttribute("stricted");if(e){this.classList.remove("faui");$(this.children[0].children[0]).show();$(this.children[0].children[1]).hide();this.removeAttribute("stricted")}else{this.classList.add("faui");$(this.children[0].children[0]).hide();$(this.children[0].children[1]).show();this.setAttribute("stricted","true")}const t=!e;if(t)$(".CDId").each((function(){if(!l.data.favorited_orgs.includes(this.children[0].getAttribute("duty")||"")){this.style.display="none"}}));else $(".CDId").show()}var wn=[];var yn=[];var En=[];function $n(){nt("event_vote_selector_screen")}function xn(){nt("event_screen")}function bn(e){return async function(){var t=[];nt("event_vote_screen");wn=[...l.data.band_votes];yn=[...l.data.dance_votes];En=[...l.data.misc_votes];$("#evote_right_now").hide();$("#godric_manager > .godric-father").remove();$("#godric_manager").scrollTop(0);switch(e){case"band":$("#evote_type").text("バンド人気投票");t=[...wn];break;case"dance":$("#evote_type").text("ダンス人気投票");t=[...yn];break;case"misc":$("#evote_type").text("その他人気投票");t=[...En];break}var n=null;async function i(t){const n=(await f)[e];if(e=="misc"){for(const e of Object.values(n)){if(Array.isArray(e))continue;for(const n of[...e.day1,...e.day2]){if(n.name==t)return n}}}else{for(const e of[...n.day1,...n.day2]){if(e.name==t)return e}}return null}for(const o of(await f)[e].vote){const s=await i(o);if(s==null){console.log(o);continue}const a=Cn(s,e);$("#godric_manager").append(a);if(t[0]==o)n=a}Tn(e);const o=(n?.offsetTop||0)-window.innerHeight/2+100+50;$("#godric_manager").scrollTop(o)}}function Tn(t){w.evote=function(){if($("#evote_right_now").attr("wait"))return;var n=[];var i=[];switch(t){case"band":n=[...wn];i=[...l.data.band_votes];break;case"dance":n=[...yn];i=[...l.data.dance_votes];break;case"misc":n=[...En];i=[...l.data.misc_votes];break}at("evote","middle");$("#evote_right_now").attr("wait","true");$.post(ajaxpath.updevote,{evotes:JSON.stringify(n),et:t}).then((()=>{if(i.length>0&&n.length>0)_o.notifySuccess(TEXTS[e].VOTE_CHANGED);else if(n.length>0)_o.notifySuccess(TEXTS[e].VOTED);else _o.notifySuccess(TEXTS[e].CANCELED_VOTING);$(".imcurrentvold").removeClass("imcurrentvold");switch(t){case"band":l.data.band_votes=[...wn];$(".godric-father").each((function(){if(l.data.band_votes.includes(this.children[0].getAttribute("duty")||""))this.classList.add("imcurrentvold")}));break;case"dance":l.data.dance_votes=[...yn];$(".godric-father").each((function(){if(l.data.dance_votes.includes(this.children[0].getAttribute("duty")||""))this.classList.add("imcurrentvold")}));break;case"misc":l.data.misc_votes=[...En];$(".godric-father").each((function(){if(l.data.misc_votes.includes(this.children[0].getAttribute("duty")||""))this.classList.add("imcurrentvold")}));break}kn(t)})).catch((()=>{_o.notifyError(TEXTS[e].ERROR_ANY)})).always((()=>{ct("evote","middle");$("#evote_right_now").attr("wait",null)}))}}function Cn(e,t){const n=document.createElement("div");const i=document.createElement("div");i.classList.add("XYId");i.setAttribute("duty",e.name);const o=document.createElement("h2");o.textContent=e.name;const s=document.createElement("p");const a=document.createElement("div");const c=document.createElement("img");if(e.musics)s.textContent="楽曲: "+e.musics;c.src=`/resources/cloud/event/${t}/${e.name.replace(/ /g,"_")}/icon.png`;c.classList.add("Oiniums");a.classList.add("fuaAW");a.appendChild(c);a.appendChild(o);i.appendChild(a);i.appendChild(s);n.appendChild(i);n.classList.add("godric-father");i.addEventListener("click",(function(){const e=this.getAttribute("duty")||"";const n=this;$(".godric-father").removeClass("imnihher");switch(t){case"band":wn.includes(e)?+function(){wn=wn.filter((t=>t!==e));wn=[];n.parentElement?.classList.remove("imnihher")}():+function(){wn.push(e);wn=[e];n.parentElement?.classList.add("imnihher")}();break;case"dance":yn.includes(e)?+function(){yn=yn.filter((t=>t!==e));yn=[];n.parentElement?.classList.remove("imnihher")}():+function(){yn.push(e);yn=[e];n.parentElement?.classList.add("imnihher")}();break;case"misc":En.includes(e)?+function(){En=En.filter((t=>t!==e));En=[];n.parentElement?.classList.remove("imnihher")}():+function(){En.push(e);En=[e];n.parentElement?.classList.add("imnihher")}();break}kn(t)}));switch(t){case"band":wn.includes(e.name)?n.classList.add("imnihher","imcurrentvold"):void 0;break;case"dance":yn.includes(e.name)?n.classList.add("imnihher","imcurrentvold"):void 0;break;case"misc":En.includes(e.name)?n.classList.add("imnihher","imcurrentvold"):void 0;break}return n}function kn(e){$("#evote_right_now").show();switch(e){case"band":lt(wn,l.data.band_votes)?$("#evote_right_now").removeClass("imhere").addClass("imbye"):$("#evote_right_now").removeClass("imbye").addClass("imhere");break;case"dance":lt(yn,l.data.dance_votes)?$("#evote_right_now").removeClass("imhere").addClass("imbye"):$("#evote_right_now").removeClass("imbye").addClass("imhere");break;case"misc":lt(En,l.data.misc_votes)?$("#evote_right_now").removeClass("imhere").addClass("imbye"):$("#evote_right_now").removeClass("imbye").addClass("imhere");break}}function Ln(){nt("misc_event_venue_screen")}function In(e,t){return async function(){nt("event_scheduler_screen");An(e,t)}}async function An(e,t){$("#godric_manager_pre").empty().scrollTop(0);switch(e){case"band":$("#event_type").text("バンドスケジュール");break;case"dance":$("#event_type").text("ダンススケジュール");break;case"misc":$("#event_type").text(`${t}-スケジュール`);break}b=Number.isNaN(b)?(await m)["d"]:b;const n=await f;var i=n[e];const[o,s]=[[],[]];const a=new Date;const c=e=="band"?b:0;var r=null;var d=1;if(e=="misc"){i=i[t||""]}for(const t of i.day1){const n=d==1?c:0;o.push(On(t,e,n))}for(const t of i.day2){const n=d==2?c:0;s.push(On(t,e,n))}var l=[];if(d==1){l=o}else if(d==2){o.forEach((e=>e.elm.classList.add("past_event")));l=s}const u=Sn(`${a.getHours()}:${a.getMinutes()}`);for(var h=0;h<l.length;h++){const e=l[h];const t=l[h+1];if(h==0&&u<e.ends){e.elm.classList.add("now_playing_event","metoscrkl");r=e.elm;break}e.elm.classList.add("past_event");if(t&&e.ends<u&&t.ends>=u){t.elm.classList.add("now_playing_event","metoscrkl");r=e.elm;break}if(!t){if(d==1){s[0].elm.classList.add("now_playing_event","metoscrkl");r=s[0].elm}else if(d==2){e.elm.classList.add("metoscrkl");r=e.elm}}}const p=document.createElement("h2");const v=document.createElement("span");const g=[p.cloneNode(),p.cloneNode()];const _=document.getElementById("godric_manager_pre");v.classList.add("delayspan_");v.innerHTML=`${c}分遅延`;g[0].textContent="一日目";g[1].textContent="二日目";c!=0?g[d-1].appendChild(v):void 0;_?.appendChild(g[0]);o.forEach((e=>_?.appendChild(e.elm)));_?.appendChild(g[1]);s.forEach((e=>_?.appendChild(e.elm)));const w=(r?.offsetTop||0)-window.innerHeight/2+100+(r?.clientHeight||0)/2;$("#godric_manager_pre").scrollTop(w)}function On(e,t,n){const i=document.createElement("div");const o=Rn(e.starts,e.takes);i.innerHTML=`\n            <div class="event_scheduler_element">\n                <div class="scheduler_time_details">\n                    ${n==0?`\n                        ${e.starts} ~ ${o}\n                    `:`\n                        <span class="aviaTa">${e.starts} ~ ${o}</span>\n                        <span>${Rn(e.starts,n)} ~ ${Rn(o,n)}</span>\n                    `}\n                </div>\n                <div class="schedular_main_details">\n                    <div class="taC">\n                        <img class="Oiniums" src="/resources/cloud/event/${t}/${e.name.replace(/ |:|\?/g,"_")}/icon.png"\n                            onerror="this.remove()">\n                        <span class="iuahT">${e.name}</span>\n                    </div>\n                    <span class="AVKT">${e.description}</span>\n                    ${typeof e.musics=="undefined"?"":`\n                        <hr class="mucdivl">\n                        <span class="evmusics">楽曲: ${e.musics.join(", ")}</span>\n                    `}\n                </div>\n            </div>`;return{ends:Sn(Rn(o,n)),elm:i}}function Sn(e){const[t,n]=e.split(":").map((e=>Number(e)));return t*60+n}function Rn(e,t){var[n,i]=e.split(":").map((e=>Number(e)));i+=t;if(i>=60){const e=Math.floor(i/60);n+=e;i=i%60}return`${n}:${i.toString().padStart(2,"0")}`}function Nn(){nt("drink_screen")}+function(){Array.from(document.querySelectorAll(".drink-real > img")).forEach((function(e){e.addEventListener("click",(function(){yo.popupMedia(e.getAttribute("src")||"","img",e.cloneNode())}))}))}();"use strict";function jn(){nt("tickets_screen");Mn()}function Mn(){const t=[...l.data.tickets];$("#ticket_component > .afIOUW").remove();if(t.length==0){const t=document.createElement("span");t.classList.add("iuhagW");t.textContent=TEXTS[e].HOW_TO_TICKET;$("#ticket_component").append(t);return}for(const e of t){const t=document.createElement("span");t.classList.add("afIOUW");const n=document.createElement("h4");n.classList.add("awWg");n.textContent=e.visual.description;t.appendChild(n);const i=document.createElement("section");i.classList.add("ticketman");t.appendChild(i);const o=document.createElement("div");o.classList.add("sauaA","protected");i.appendChild(o);const s=document.createElement("img");s.classList.add("agiuW");s.src=e.visual.image;o.appendChild(s);const a=document.createElement("div");a.classList.add("asIgW");i.appendChild(a);const c=document.createElement("p");c.textContent=e.visual.moredetails;a.appendChild(c);const r=document.createElement("div");r.classList.add("diusahG");a.appendChild(r);const d=document.createElement("div");d.classList.add("shishijibtn","AWtv");d.style.width="130px";r.appendChild(d);const l=document.createElement("span");l.textContent="使用する";d.appendChild(l);const u=document.createElement("div");u.classList.add("shishijibtn","AWtv");u.style.width="130px";r.appendChild(u);const h=document.createElement("span");h.textContent="場所を確認";u.appendChild(h);d.addEventListener("click",Dn(e));u.addEventListener("click",(()=>{it("tickets_screen");no(e.visual.use_coords)}));$("#ticket_component").prepend(t)}}function Dn(e){return async function(){nt("ticket_use_screen");$("#_what_ticket").text(e.visual.description);$("#ticket_qrcode").attr("src",e.qrcode)}}function Bn(){nt("tea_screen");const e=l.data.completed_orgs;$("#ASUgAJs > div").remove();for(const t of Object.values(V)){$("#ASUgAJs").append(`\n                <div>\n                    <input id="__W${t.discriminator}" type="checkbox" class="setartw" who="${t.discriminator}" ${e.includes(t.discriminator)?"checked":""}>\n                    <lable for="__W${t.discriminator}">${t.discriminator}</lable>\n                </div>\n            `);$(`#__W${t.discriminator}`).on("input",(function(){$.post("/.dev/faith",{_where:this.getAttribute("who"),_process:this.checked?"add":"remove"}).then((async e=>{l.data.completed_orgs=e;Fi();if(await Vn()){_t("1")}}))}))}}function Hn(){nt("showcase_screen")}async function Xn(){nt("stamp_rally_screen");await Pn();if(yt("ranking")){y.pkgo=true;setTimeout((()=>Et("ranking")),300)}}async function Pn(){const t=[1/5,3/5,5/5];const n=await p;const i=await v;const o=structuredClone(l.data.claimed_rpt);const s=[];const a={};$("#intermain, #aka-keeen").empty();function c(){Object.values(a).some((e=>e==true))?wt("1"):_t("1")}function r(){const e=s.map((e=>`<div class="comaos"><p>${e}</p></div>`)).join("");if(!document.getElementById("asW"))$("#aka-keeen").append(`\n                    <div class="aaiV" id="asW">\n                        <span class="sagAW">完了済み</span>\n                        ${e}\n                    </div>`);else $("#asW").append(e);s.length=0}for(const i of["1F","2F","3F","4F"]){+function(i){const d=ut(i,true);const u=d.length;const h=o[i];const f=[];const m=document.createElement("span");var p=0;var v=u*t[0];var g=0;document.getElementById("intermain")?.appendChild(m);for(const e of d){ht(e)?p++:void 0}for(var _=0;_<t.length;_++){const e=t[_];const n=Math.floor(u*e);if(n==0)break;if(n>p){v=n;break}else{if(h<_){f.push(_);a[i]=true}}g++}const w=n[i][g]||0;function y(e,t){t?c():void 0;if(p==u){s.push(`${i}の団体を全て訪れる`);if(t){m.classList.add("asbHW");setTimeout((()=>m.remove()),100)}else{m.remove()}r();return}const n=Fn({title:`${i} の団体を${v}コ訪れる`,progress:p/v*100,compPT:w,reelcount:p},e);m.appendChild(n)}if(f.length>0){const o=[];for(const e of f){const s=Un({title:`${i} の団体を${Math.floor(u*t[e])}コ訪れる`,progress:100,compPT:n[i][e],reelcount:Math.floor(u*t[e])});o.push({rwidx:e,elm:s})}var E=0;for(const t of o){+function(t){t.elm.addEventListener("click",(async function(){this.classList.add("plopper");at(`getrpt-${i}-${t.rwidx}`,"top");$.post(ajaxpath.uactrpt,{floor:i,idx:t.rwidx}).then((e=>{const t=e.neu;const n=e.ucl;const i=e._gets;l.data.pt=Number(t);l.data.claimed_rpt=n;Wn();gt(`${i}pt`);mt();if(!Vn())wt("1")})).catch((()=>{_o.notifyError(TEXTS[e].SRY_OPEN_AGAIN)})).always((()=>ct(`getrpt-${i}-${t.rwidx}`,"top")));setTimeout((()=>{const e=o[++E];if(e){e.elm.classList.add("awlvig");m.appendChild(e.elm)}else{a[i]=false;delete a[i];y(true,true)}this.remove()}),550)}))}(t)}m.appendChild(o[0].elm)}else{y(false,false)}}(i)}function d(t,n){return async function(){this.classList.add("plopper");s.push(t.title);r();setTimeout((()=>{n.classList.add("asbHW");setTimeout((()=>n.remove()),100)}),550);$.post(ajaxpath.uactrsppt,{mission_id:t.mission_id}).then((e=>{gt("チケット");a[t.mission_id]=false;delete a[t.mission_id];l.data.tickets=e._new;l.data.claimed_rpt=e._dnew;c()})).catch((t=>{_o.notifyError(TEXTS[e].SRY_OPEN_AGAIN)}))}}for(const e of i){if(o.specials.includes(e.mission_id)){s.push(e.title);r();continue}+function(e){const t=document.createElement("span");const n=l.data.pt/e.required_pt*100;document.getElementById("intermain")?.appendChild(t);const i=d(e,t);if(n>=100){const n=Un({title:e.title,reward:e.reward});n.addEventListener("click",i);t.appendChild(n);a[e.mission_id]=true}else{const n=Gn(e,false);t.appendChild(n);n.addEventListener("become-claimable",(function(){const n=Un({title:e.title,reward:e.reward});this.remove();n.addEventListener("click",i);t.appendChild(n);a[e.mission_id]=true}))}}(e)}}function Gn(e,t){const n=l.data.pt/e.required_pt*100;const i=document.createElement("section");i.classList.add("diauHOkjkjsa",t?"awlvig":"_","av8YWTg");i.innerHTML=`\n            <div class="execil">\n                <div class="cureft"><p>${e.title}</p></div>\n                <div class="stampprogress specialprogress" requires="${e.required_pt}">\n                    <span style="width:${n}%"></span>\n                    <div style="left:calc(${n}% - 4.5px)">${l.data.pt}</div>\n                </div>\n            </div>\n            <div class="execij flxxt agawt">\n                <img src="${e.reward.image}" class="auiwB">\n                <p>${e.reward.description}</p>\n            </div>\n        `;return i}function Wn(){$(".specialprogress").each((function(){const e=this.children[0];const t=this.children[1];const n=Number(this.getAttribute("requires"));const i=l.data.pt/n*100;if(i>=100){this.parentElement?.parentElement?.dispatchEvent(new Event("become-claimable"))}else{$(e).css("width",`${i}%`);$(t).css("left",`calc(${i}% - 4.5px)`).text(l.data.pt.toString())}}))}function Fn(e,t){const n=document.createElement("section");n.classList.add("diauHOkjkjsa",t?"awlvig":"_");n.innerHTML=`\n            <div class="execil">\n                <div class="cureft"><p>${e.title}</p></div>\n                <div class="stampprogress">\n                    <span style="width:${e.progress}%"></span>\n                    <div style="left:calc(${e.progress}% - 4.5px)">${e.reelcount}</div>\n                </div>\n            </div>\n            <div class="execij flxxt">\n                <span>\n                    <h4>${e.compPT}pt</h4>\n                </span>\n            </div>\n        `;return n}function Un(e){const t=document.createElement("section");const n=e.reelcount?`\n            <span>\n                <h4>${e.compPT}pt</h4>\n            </span>`:`<img src="${e.reward.image}" class="auiwB"><p>${e.reward.description}</p>`;t.classList.add("uoihgfaSJD");t.innerHTML=`\n            <div class="execil flxxt">\n                <div class="gjaiuags">\n                    <p>リワードを受け取る</p>\n                    <p class="smallerp">${e.title}</p>\n                </div>\n            </div>\n            <div class="execij flxxt AMVat agawt">\n                ${n}\n            </div>\n        `;return t}function Yn(e,t){const n=document.createElement("section");n.classList.add("iuhgihuASG",t?"awlvig":"_");n.innerHTML=`\n            <div class="euahcn flxxt">\n                <div class="gjaiuags">\n                    <h4>${e.title} (${e.reelcount}コ)</h4>\n                </div>\n            </div>\n        `;return n}function qn(){nt("ranking_screen");Jn()}function Jn(){at("getting-mission-ranking","top");$(".ahugihdb").hide();$(".hbSDBs").addClass("gaius");$("#aboigHSDV").empty();$.post(ajaxpath.ranking).then((e=>{var t=false;var n={pt:Infinity,place:0,dps:1,pre:0};for(var i=1;i<=e.length;i++){const r=e[i-1];const d=pt(r.pt);var o=r.pt<n.pt?n.pre+n.dps:n.pre;var s=`<b-i>${o}</b-i>`;var a="";if(r.pt<n.pt){n.dps=1}else{n.dps++}n.pre=o;if(o<=3){var c="";if(o==1){c="giuja";a+="oaguhsT"}else if(o==2){c="giujaR";a+="h4eADFS"}else if(o==3){c="giujfR";a+="gAJISW3"}s=`<h2 class="${c}">${o}</h2>`}$("#aboigHSDV").append(`\n                    <div class="ranking_person ${a} ${r.disc==l.discriminator?"hugaop":""}" id="printouts-${r.disc}">\n                        <div class="reavhs">\n                            ${s}\n                            <div style="${r.icp?`background-image:url(${r.icp})`:""}">\n                                <div class="usahbas" style="${d?`background-image:url(${d})`:""}"></div>\n                            </div>\n                            <h4>${r.nick}</h4>\n                        </div>\n                        <p>${r.pt}pt</p>\n                    </div>`);n.pt=r.pt;n.place=o;!t?r.disc==l.discriminator?t=!t:void 0:void 0}if(t){$(".hbSDBs").removeClass("gaius");$(".ahugihdb").show()}else{$(".gaius").append(document.createElement("h-j"))}})).catch((()=>_o.notifyError(TEXTS[e].FAILED_TO_LOAD_RANKING))).always((()=>ct("getting-mission-ranking","top")))}function zn(){const e=`printouts-${l.discriminator}`;document.getElementById(e)?.scrollIntoView({behavior:"smooth",block:"center"})}async function Vn(){const e=[1/5,3/5,5/5];const t=l.data.claimed_rpt;var n=false;for(const i of["1F","2F","3F","4F"]){if(n)break;+function(i){const o=ut(i,true);const s=o.length;const a=t[i];var c=0;var r=s*e[0];var d=0;for(const e of o){ht(e)?c++:void 0}for(var l=0;l<e.length;l++){const t=e[l];const i=Math.floor(s*t);if(i==0)break;if(i>c){r=i;break}else{if(a<l){n=true;break}}d++}}(i)}const i=await v;for(const e of i){if(n)break;+function(e){const t=l.data.pt/e.required_pt;if(t>=1&&!l.data.claimed_rpt.specials.includes(e.mission_id)){n=true}}(e)}return n}const Kn=[[[2100,384],[1170,435]]];function Zn(e,t){Kn}function Qn(e,t){const n=ri(e),i=ri(t);o.beginPath();o.lineWidth=20*a;o.strokeStyle="#009dff";o.moveTo(n[0],n[1]);o.lineTo(i[0],i[1]);o.stroke();o.closePath()}function ei(e,t){const n=ri(e);const i=o.measureText(t).width;n[0]-=i/2;n[1]+=8;o.textBaseline="alphabetic";o.font="16px Calligraphed";o.fillStyle="#ffffff";o.fillText(t,n[0],n[1])}function ti(e){if(e.length==1)return 0;var t=0;var n=0;var i=0;for(var o of Array.from(e)){t+=o.clientX;n+=o.clientY}const s={x:t/e.length,y:n/e.length};for(var o of Array.from(e)){const e=Math.abs(Math.sqrt((o.clientX-s.x)**2+(o.clientY-s.y)**2));i+=e}return 2*i/e.length}function ni(e){var t=0;var n=0;const i=e.length;for(const i of e){t+=i.clientX;n+=i.clientY}t/=i;n/=i;return[t,n]}function ii(e){const t=Math.abs,n=Math.sqrt,i=Math.pow;const o=[e[0].clientX,window.innerHeight-e[0].clientY],s=[e[1].clientX,window.innerHeight-e[1].clientY];const a=[o,s];const c=t(n(i(a[0][0]-a[1][0],2)+i(a[0][1]-a[1][1],2)));const r=1/c*(a[1][1]-a[0][1]);const d=1/c*(a[1][0]-a[0][0]);var l=Math.acos(d);if(r<0){l=2*Math.PI-l}if(Math.abs(l-W)>Math.PI/2){}return l}function oi(e){H.touches=[];for(var t of e){H.touches.push({x:t.clientX,y:t.clientY});H.real=Array.from(e)}}function si(e){var t=new et(e[0],e[1]);for(const e of u){t=t.rotate(-e.arg,e.canvasOrigin)}return di([t.real,t.imag])}function ai(e){const t=[[e[0].clientX,e[0].clientY],[e[1].clientX,e[1].clientY]];const n=[t[0][0]+t[1][0]/2,t[1][1]+t[0][1]/2];return n}function ci(e,t){return Math.abs(Math.sqrt((e.clientX-t.clientX)**2+(e.clientY-t.clientY)**2))}function ri(e){return[(e.x-T.canvas.coords.x)*a,(e.y-T.canvas.coords.y)*a]}function di(e){return{x:e[0]/a+T.canvas.coords.x,y:e[1]/a+T.canvas.coords.y}}function li(e){return{x:e[0]/a+T.canvas.coords.x,y:e[1]/a+T.canvas.coords.y}}async function ui(t,n,s){const a=t.xrange;const c=t.yrange;const r=t.tile_width;const d=t.tile_height;const l=t.format;var u=[];var h=0;var f=0;var m=[];const p=(a+1)*(c+1);const v={width:(a+1)*r,height:(c+1)*d};const g=2**12;o.clearRect(0,0,i.width,i.height);I.forEach((e=>e.forEach((e=>e.remove()))));I.splice(0);function _(e,t){const n=document.createElement("canvas");n.width=e;n.height=t;return n}if(v.width*v.height>2**24){for(var w=0;w<Math.ceil(v.width/g);w++){for(var y=0;y<Math.ceil(v.height/g);y++){const e=_(g,g);y>0?I[w].push(e):I[w]=[e]}}}else{const e=_(v.width,v.height);I[0]=[e]}const E={all:(a+1)*(c+1),loaded:0};function x(e,t,n,i,o){const s=Math.floor;const a=[t,n];const c=[t+i,n+o];const r=[s(a[0]/g),s(a[1]/g)];const d=[s(c[0]/g),s(c[1]/g)];const l=[...a];const u=[...r];var h=i;var f=o;var m=t%g;var p=n%g;const v=[0,0];for(var _=r[1];_<=d[1];_++){var w=f;if(s((p+f)/g)/s(p/g)>1){w=g-p%g}h=i;m=t%g;v[0]=0;u[0]=r[0];for(var y=r[0];y<=d[0];y++){while(h>0){var E=h;if(s((m+h)/g)/s(m/g)>1){E=g-m%g}if(m==g)m=0;if(p==g)p=0;const t=A(u[0],u[1]);t?.getContext("2d")?.drawImage(e,v[0],v[1],E,w,m,p,E,w);u[0]++;m+=E;v[0]+=E;h-=E}}p+=w;f-=w;v[1]+=w;u[1]++}}return new Promise((t=>{for(var n=0;n<=c;n++){for(var i=0;i<=a;i++){var o=r,v=d,g=v*i,_=o*n;!function(n,i,o,a,c,r){const d=new Image;const v=Ee(l,i,n);d.onload=function(){x(d,o,a,c,r);f++;E.loaded++;u.push(d);if(s)s(E.loaded,E.all);if(u.length>=p)t("map loaded")};function g(){var t=S;const n=setInterval((()=>{Re(Ee(TEXTS[e].MAP_LOAD_RETRYING,t));$(".loader__icon").removeClass("_gloads").addClass("_bgoods");_o.notify("no-wifi",TEXTS[e].NOTIFICATION_CHECK_YOUR_CONNECTION,{duration:5e3,discriminator:"check ur WiFi",deny_userclose:true});t--;if(t<=-1){$(".loader__icon").removeClass("_bgoods").addClass("_gloads");w();clearInterval(n)}}),1e3)}function _(){var e=S;f++;if(f>=p)g()}function w(){for(const n of m){const i=new Image;const o=n.src;if(s)s(E.loaded,E.all);else Re(TEXTS[e].LOADING_MAP);f--;i.onload=function(){x(i,n.dx,n.dy,n.dw,n.dh);m=m.filter((e=>{if(e.src!=o)return true}));f++;E.loaded++;u.push(i);if(s)s(E.loaded,E.all);if(u.length>=p)t("map loaded");else if(f>=p)g()};i.onerror=_;i.src=o}}d.onerror=()=>{m.push({x:n,y:i,dx:o,dy:a,dw:c,dh:r,src:v});_()};setTimeout((()=>{d.src=v}),h);h+=_e;return 0}(i,n,g,_,v,o)}}})).then((()=>{window.scroll({top:0,behavior:"instant"});function e(e){const t=document.createElement("canvas");const n=A()||[[]];var i=0;var o=0;e=e===void 0?1:e;o=n.length*2**12;i=n[0].length*2**12;t.width=i;t.height=o;var s=0;for(const e of n){var a=0;for(const n of e){t.getContext("2d")?.drawImage(n,0,0,n.width,n.height,s*2**12,a,n.width,n.height);a+=n.height}s++}const c=document.createElement("canvas");var r=1,d=[1];c.width=window.innerWidth*e;c.height=window.innerHeight*e;d=[c.width/t.width,c.height/t.height];r=Math.max(...d);c.getContext("2d")?.drawImage(t,0,0,t.width,t.height,0,0,t.width*r,t.height*r);c.style.top="0";c.style.left="0";c.style.zIndex="9999999";c.style.position="fixed";c.style.pointerEvents="none";c.id="canvas_children_debugger";document.body.prepend(c)}if(typeof n==="function")n(u)}))}function hi(e){const t=10**fe;const n=[T.canvas.coords.x,T.canvas.coords.y];const i=e?a:Math.round(a*t)/t;const o=e?n[0]+","+n[1]:Math.round(n[0]*t)/t+","+Math.round(n[1]*t)/t;Be(me.ZOOM_RATIO,i);Be(me.COORDS,o)}function fi(e,t,n){if(t===void 0){t=a}const i=document.getElementById("shishiji-canvas");const o=i.getContext("2d");const s={top:window.innerHeight/2,left:window.innerWidth/2};const c={x:(t*e.x-s.left)/t,y:(t*e.y-s.top)/t};a=t;T.canvas.coords=c;_i({left:0,top:0});n?hi():void 0}function mi(e,t,n){const i=`<h4>${t?.over||""}</h4><div id="map_load_progress"><div id="ml_progress"></div></div><h4>${t?.under||""}</h4>`;ui(e,n,(function(e,t){var n=e/t;const o=document.getElementById("ml_progress");if(!o){Re(i)}}));return function(e){document.getElementById("ml_progress").style.width=e*100+"%"}}function pi(e){const t=new Image;t.src=e.spare;e.spareImage=t;return e}function vi(e){if(e instanceof MouseEvent)t=[e.clientX,e.clientY];else t=ni(e)}function gi(e){W=ii(e)}function _i(e,t){const[n,o]=[Math.sin(-F),Math.cos(-F)];const s={...e};e={top:s.top*o-s.left*n,left:s.top*n+s.left*o};var c=T.canvas.coords.x-e.left/a,r=T.canvas.coords.y-e.top/a;T.canvas.width=i.width/a;T.canvas.height=i.height/a;T.canvas.coords={x:c,y:r};const d=5e3;const l=5e3;if(T.canvas.coords.x+T.canvas.width>d){T.canvas.coords.x=d-T.canvas.width}if(T.canvas.coords.y+T.canvas.height>l){T.canvas.coords.y=l-T.canvas.height}if(T.canvas.coords.x<2500-d){T.canvas.coords.x=2500-d}if(T.canvas.coords.y<2500-l){T.canvas.coords.y=2500-l}xi(T,...[T.canvas.coords.x,T.canvas.coords.y],T.canvas.width,T.canvas.height,0,0,i.width,i.height,t)}function wi(e,t,n){const i=T.canvas.coords.y-n.left/a;const o=T.canvas.coords.x-n.top/a;T.canvas.coords={x:i,y:o};T.canvas.width=e.width/a;T.canvas.height=e.height/a;t.clearRect(0,0,e.width,e.height);t.drawImage(T,Math.floor(T.canvas.coords.x),Math.floor(T.canvas.coords.y),Math.floor(T.canvas.width),Math.floor(T.canvas.height),0,0,e.width,e.height)}function yi(e,t,n,o,s){if(Ge(e,false))return;n??=[T.canvas.coords.x,T.canvas.coords.y];a=o?e:a*e;if(t.length==2&&e!=1){var c=[];for(var r=0;r<2;r++){c.push(t[r]*(e-1)/a+n[r])}T.canvas.coords={x:c[0],y:c[1]}}T.canvas.width=i.width/a;T.canvas.height=i.height/a;if(!s)xi(T,Math.floor(T.canvas.coords.x),Math.floor(T.canvas.coords.y),Math.floor(T.canvas.width),Math.floor(T.canvas.height),0,0,i.width,i.height)}function Ei(e,t,n,i,o){if(O.caps.ratio.max<a&&n>1||O.caps.ratio.min>a&&n<1)return;o??=[T.canvas.coords.x,T.canvas.coords.y];a*=n;if(i.length==2&&n!=1){var s=[];for(var c=0;c<2;c++){s.push(i[c]*(n-1)/a+o[c])}T.canvas.coords={x:s[0],y:s[1]}}T.canvas.width=e.width/a;T.canvas.height=e.height/a;t.clearRect(0,0,e.width,e.height);t.drawImage(T,Math.floor(T.canvas.coords.x),Math.floor(T.canvas.coords.y),Math.floor(T.canvas.width),Math.floor(T.canvas.height),0,0,e.width,e.height)}function $i(e,t){const n=[0,0];const i=e.getContext("2d");function o(t){return Math.max(e.width/t.width,e.height/t.height)}if(typeof t=="string"){i?.beginPath();i.fillStyle=t;i?.fillRect(0,0,e.width,e.height);i?.stroke();i?.closePath()}else{const c=o();if(c<1){i?.drawImage(t,...n,t.width*c,t.height*c)}else if(t.width!=0&&t.height!=0){for(var s=0;s<Math.ceil(e.height/t.height);s++){for(var a=0;a<Math.ceil(e.width/t.width);a++){i?.drawImage(t,...n,t.width,t.height);n[0]+=t.width}n[0]=0;n[1]+=t.height}}}}function xi(e,t,n,s,c,r,d,l,h,f){const m=[t,n];var p;var v=[t,n,s,c,r,d,l,h];f??={rotated:0,origin:[i.width/2,i.height/2]};const g=Math.floor;const _=A();const w=l/s;const y=T.getContext("2d");const E=oe[se].spare;y?.clearRect(0,0,T.width,T.height);o.clearRect(0,0,i.width,i.height);if(t<0||n<0){p=m.map((e=>-e));v=[0,0,s-p[0],c-p[1],p[0]*a,p[1]*a,l-p[0]*a,h-p[1]*a]}if(_&&_.length==1&&_[0].length==1){function $(e){const t=e.origin;const n=li(t);F+=e.rotated;u.push({canvasOrigin:new et(t[0],t[1]),BackOrigin:new et(n.x,n.y),arg:e.rotated});function s(e){return Math.pow((e[0]-t[0])**2+(e[1]-t[1])**2,.5)}const a=document.createElement("canvas");const c=Math.max(s([0,0]),s([0,i.height]),s([i.width,0]),s([i.width,i.height]));const r=c*2;const d=a.getContext("2d");const l=li([t[0]-c,t[1]-c]);const h=li([t[0]+c,t[1]+c]);const f={width:h.x-l.x,height:h.y-l.y};a.width=a.height=r;d?.translate(c,c);d?.rotate(-F);d?.translate(-c,-c);$i(a,E);const m={sx:l.x,sy:l.y,sw:f.width,sh:f.height,dx:0,dy:0,dw:r,dh:r};if(m.sx<0||m.sy<0){const e=r/f.width;m.sw=m.sw+m.sx;m.sh=m.sh+m.sy;m.sx=m.sy=0;m.dx=m.dw-m.sw*e;m.dy=m.dh-m.sh*e;m.dw=m.sw*e;m.dh=m.sh*e}d?.drawImage(_[0][0],...Object.values(m));o.drawImage(a,c-t[0],c-t[1],c-t[0]+i.width-(c-t[0]),c-t[1]+i.height-(c-t[1]),0,0,i.width,i.height);Yi();qi();a.remove()}function x(e){T.width=i.width;T.height=i.height;$i(T,E);y?.drawImage(_[0][0],...v);o.drawImage(T,Math.floor(r),Math.floor(d),Math.floor(l),Math.floor(h));Yi();qi()}x(f)}else{T.width=l-2;T.height=h-2;$i(T,E);if(t<0){v[2]=s;v[4]=g(-t*w)}if(n<0){v[3]=c;v[5]=g(-n*w)}const j=v[0],M=v[1],D=v[2],B=v[3],H=v[4],X=v[5],P=v[6],G=v[7];const W=2**12;const U=[j,M];const Y=[j+D,M+B];const q=[g(U[0]/W),g(U[1]/W)];const J=[g(Y[0]/W),g(Y[1]/W)];const z=[...q];var b=D;var C=B;var k=j%W;var L=M%W;const V=[g(H),g(X)];const K=[b,C];const Z=[...V];for(var I=q[1];I<=J[1];I++){var O=C;L=L%W;if(g((L+C)/W)/g(L/W)>1){O=W-L%W}b=K[0];k=j%W;V[0]=Z[0];z[0]=q[0];for(var S=q[0];S<=J[0];S++){while(b>0){var R=b;if(g((k+b)/W)/g(k/W)>1){R=W-k%W}if(k==W)k=0;if(L==W)L=0;const Q=A(z[0],z[1]);const ee=g(R*w),te=g(O*w);if(Q!=null)y?.drawImage(Q,Math.floor(k),Math.floor(L),Math.floor(R),Math.floor(O),Math.floor(V[0]),Math.floor(V[1]),Math.floor(ee),Math.floor(te));z[0]++;k+=R;b-=R;V[0]+=ee}}L+=O;C-=O;V[1]+=g(O*w);z[1]++}ctx.drawImage(T,r,d,l,h);function*N(){for(var e=q[1];e<=J[1];e++){for(var t=q[0];t<=J[0];t++){const n=A(t,e);const i=U[0]-W*t,o=q[1]-W*e,s=J[0]*W>Y[0]?W:Y[0]-W*t,a=J[1]*W>Y[1]?W:Y[1]-W*e;if(n!=null)T.getContext("2d")?.drawImage(n,Math.floor(i),Math.floor(o),Math.floor(s),Math.floor(a),0,0,T.width,T.height)}}xi(T,T.canvas.coords.x,T.canvas.coords.y,T.canvas.width,T.canvas.height,0,0,i.width,i.height)}Yi();qi()}}function bi(e,t){if(t===void 0){t=T.canvas.rotation}function n(t){return Math.pow((t[0]-e[0])**2+(t[1]-e[1])**2,.5)}const s=T.getContext("2d");const a=document.createElement("canvas");const c=Math.max(n([0,0]),n([0,i.height]),n([i.width,0]),n([i.width,i.height]));const r=c*2;const d=li([e[0]-c,e[1]-c]);const l=li([e[0]+c,e[1]+c]);const u=a.getContext("2d");const h=oe[se].spareImage||new Image;a.width=a.height=r;s?.clearRect(0,0,T.width,T.height);o.clearRect(0,0,i.width,i.height);T.width=i.width;T.height=i.height;$i(T,h);s?.drawImage(A()[0][0],T.canvas.coords.x,T.canvas.coords.y,T.canvas.width,T.canvas.height,0,0,i.width,i.height);u?.translate(c,c);u?.rotate(-t);u?.drawImage(T,-c,-c,r,r,d.x,d.y,l.x-d.x,l.y-d.y);o.drawImage(a,0,0,i.width,i.height,c-e[0],c-e[1],c-e[0]+i.width-(c-e[0]),c-e[1]+i.height-(c-e[1]))}function Ti(e){var t=[-1,-1];const n=Math.abs;const i=e.touches;var o=false;Y++;const s={previous:{slope:(H.real[0].clientY-H.real[1].clientY)/(H.real[0].clientX-H.real[1].clientX)},this:{slope:(i[0].clientY-i[1].clientY)/(i[0].clientX-i[1].clientX)}};const a=ti(i);var c=a/B.distance;if(B.x==-1&&B.y==-1&&B.distance==-1){c=1}B.distance=a;if(s.previous.slope==s.this.slope){var r=i[0].clientX-H.touches[0].x;var d=i[1].clientX-H.touches[1].x;r===0&&d===0||r+d==0?r=d=1:void 0;const e=r/(n(r)+n(d));const t=n(i[0].clientX-i[1].clientX)*e;const o=n(i[0].clientY-i[1].clientY)*e;const s=[i[0].clientX+t,i[0].clientY+o];H.middle=s}else{const e=(H.real[0].clientX*s.previous.slope-i[0].clientX*s.this.slope-H.real[0].clientY+i[0].clientY)/(s.previous.slope-s.this.slope);const n=s.this.slope*(e-i[0].clientX)+i[0].clientY;t=[e,n];if(!t.some((e=>isNaN(e))))0}if(Ge(c,false))c=1;const l=ni(H.real);const u=ni(i);const h=l[0]*c;const f=l[1]*c;const m=u[0]-h;const p=u[1]-f;var v=0;+function(){const e=Math.PI;const t=ii(i);if(W===-1)v=0;else if(0<=W&&W<=e&&e*(3/2)<=t&&t<=2*e)v=-(2*e-t+W);else if(0<=t&&t<=e&&e*(3/2)<=W&&W<=2*e)v=2*e-W+t;else v=t-W;W=t;P+=Math.abs(v);X+=v;if(Math.abs(X)>$e(O.touch.rotate.min)||G){if(!G){X-=$e(O.touch.rotate.min)}G=o=true}}();if(Y>O.touch.zoomCD){yi(c,[0,0],void 0,void 0,true);_i({top:p,left:m},o?{rotated:v,origin:t}:void 0)}return{diffRatio:c,crossPos:t,rotation:v,allowRotation:o}}function Ci(e){const n=e.touches;const i=ni(n);const o=t;var s={diffRatio:1,crossPos:[-1,-1],rotation:0,allowRotation:false};t=i;if(U<O.touch.downCD){U++;return}if(n.length>=2&&H.real!==void 0&&H.real.length>=2){s=Ti(e);H.zoom=true}else{G=false;X=0;P=0;W=-1;Y=0;H.cross=[-1,-1];function a(){var e={clientX:H.real[0].clientX,clientY:H.real[0].clientY,velocity:j[0]};var t={clientX:H.real[1].clientX,clientY:H.real[1].clientY,velocity:j[1]};+function(e,t){const n=[e,t];const i=j.a;function o(e){return e<0?-1:1}if(D!==null)clearInterval(D);if(isNaN(e.velocity.x)||isNaN(e.velocity.y)||isNaN(t.velocity.x)||isNaN(t.velocity.y))return}(e,t)}if(false)a();H.zoom=false}if(!o.some((e=>e===null))&&n.length==1){const c={left:i[0]-o[0],top:i[1]-o[1]};_i(c)}H.cross=s.crossPos;oi(n)}function ki(e){var t=O.scroll*1;e.deltaY>0?t=1/t:void 0;yi(t,n)}function Li(e){const t=$e(2);const i=e.deltaY<0?1:-1;_i({top:0,left:0},{rotated:t*i,origin:n})}function Ii(e){const n=[e.clientX,e.clientY];const i={left:n[0]-t[0],top:n[1]-t[1]};_i(i);t=n}function Ai(...e){}const Oi={arrowup:{pressing:false,_do:function(e){if(!Si.ctr)e.top+=Si.shift?O.arrowkeys.nosprint:O.arrowkeys.move;else yi(Si.shift?O.arrowkeys.nosprintratio:O.arrowkeys.ratio,[i.width/2,i.height/2]);return e},_leave:function(){Ai(0,O.arrowkeys.move*1e3/O.arrowkeys.interval)}},arrowdown:{pressing:false,_do:function(e){if(!Si.ctr)e.top+=Si.shift?-O.arrowkeys.nosprint:-O.arrowkeys.move;else yi(Si.shift?1/O.arrowkeys.nosprintratio:1/O.arrowkeys.ratio,[i.width/2,i.height/2]);return e},_leave:function(){Ai(0,-O.arrowkeys.move*1e3/O.arrowkeys.interval)}},arrowleft:{pressing:false,_do:function(e){e.left+=Si.shift?O.arrowkeys.nosprint:O.arrowkeys.move;return e},_leave:function(){Ai(O.arrowkeys.move*1e3/O.arrowkeys.interval,0)}},arrowright:{pressing:false,_do:function(e){e.left+=Si.shift?-O.arrowkeys.nosprint:-O.arrowkeys.move;return e},_leave:function(){Ai(-O.arrowkeys.move*1e3/O.arrowkeys.interval,0)}}};const Si={ctr:false,shift:false};var Ri=0;function Ni(){clearInterval(Ri);clearTimeout(R);Ri=setInterval((()=>{var e={top:0,left:0};for(const t in Oi){if(Oi[t].pressing)e=Oi[t]._do.call(0,e)}_i(e)}),O.arrowkeys.interval)}function ji(){clearInterval(Ri)}window.addEventListener("keydown",(function(e){const t=e.key.toLowerCase();Si.ctr=e.ctrlKey;Si.shift=e.shiftKey;if(t in Oi){var n=0;Object.keys(Oi).forEach((e=>{if(Oi[e].pressing)n++}));if(n==0){Ni()}Oi[t].pressing=true}}));window.addEventListener("keyup",(function(e){const t=e.key.toLowerCase();Si.ctr=e.ctrlKey;Si.shift=e.shiftKey;if(t in Oi){Oi[t].pressing=false;var n=0;Object.keys(Oi).forEach((e=>{if(Oi[e].pressing)n++}));if(n==0){ji();R=setTimeout((()=>{hi()}),d)}}}));async function Mi(e){const t=document.getElementById("shishiji-view");const n=document.getElementById("shishiji-overview");const i=e.object.type.behavior;const o=e.discriminator;var s=1001;const c={x:(e.object.coordinate.x-T.canvas.coords.x)*a,y:(e.object.coordinate.y-T.canvas.coords.y)*a};var r="";var d="";var l="pointer";const u=Ee(ve,o);const h=Ve(e);const f=h(o,e.object.images.icon);switch(i){case"dynamic":d+="popups realshadow ";break;default:case"static":s=999;d+="mapObj_static";if(!e.object.type.border)r+="border: none; border-radius: 0; background-color: transparent;";if(!e.article&&!e.object.open_screen){r+="cursor: default; pointer-events: none;";l="default"}break}if(e.object.open_screen){d+="aiughW "}const m={df:"",st:""};m.df=`dfsize="${e.object.size.width} ${e.object.size.height}"`;m.st=`min-width:${e.object.size.width}px;min-height:${e.object.size.height}px;max-width:${e.object.size.width}px;max-height:${e.object.size.height}px;`;const p=`\n            <div id="${u}" class="mpob centeral" style="transform: translate(${c.x}px, ${c.y}px); z-index: ${s};"\n                coords="${e.object.coordinate.x} ${e.object.coordinate.y}"\n                behavior="${e.object.type.behavior}"\n                ${m.df}>\n                <div class="flxxt ${i=="dynamic"?"interrealface":""} canvas_interactive mpobmctx ${d}" style="${m.st}${r}" dfcs="${l}">\n                    <div class="ashuW" style="background-image:url('${f}')"></div>\n                </div>\n            </div>`;$(t).append(p);e.article?Ki(e.discriminator,e.article.crowd_status):void 0;const v=$(t).children()[$(t).children().length-1];if(e.article){Me(v,(function(t,n){const i=e;this.children[0].classList.add("ADSHIiuhbgnajsyu");oo.reduceCoro.push((()=>this.children[0].classList.remove("ADSHIiuhbgnajsyu")));so();lo(i,true);Be(me.ARTICLE_ID,e.discriminator);hi();N.v=N.x=N.y=0}),{forceLeft:true,arg1:function(){return void 0}})}else if(e.object.open_screen){Me(v,(function(){nt(e.object.open_screen||"")}))}}function Di(){$(".mpob").remove()}function Bi(e){var t=e.getContext("2d");var n=e.width;var i=e.height;var o=t.getImageData(0,0,n,i);var s=o.data;for(var a=0;a<s.length;a+=4){s[a]*=.75;s[a+1]*=.75;s[a+2]*=.75}t.putImageData(o,0,0)}function Hi(e){var t=e.getContext("2d");var n=e.width;var i=e.height;var o=t.getImageData(0,0,n,i);var s=o.data;for(var a=0;a<s.length;a+=4){s[a]/=.75;s[a+1]/=.75;s[a+2]/=.75}t.putImageData(o,0,0)}function Xi(e,t){for(const n in t){if(t[n].object.floor==e){Mi(t[n])}}Yi();qi()}function Pi(){Object.keys(V).forEach((e=>eo(e)))}function Gi(){Pi();for(const e of l.data.completed_orgs){Vi(e)}}function Wi(){Pi();for(const e of l.data.favorited_orgs){Qi(e)}}function Fi(){Pi();for(const e of l.data.completed_orgs){Vi(e)}for(const e of l.data.favorited_orgs){Qi(e)}}function Ui(e){const t=$($(e).children()[0]);const n=window.getComputedStyle(e).transform;const i=n.match(/matrix\((.+)\)/)?.[1]?.split(", ");const o={x:parseFloat(i?.[4]||"0"),y:parseFloat(i?.[5]||"0")};const s={width:parseFloat(t.css("min-width")?.replace("px","")),height:parseFloat(t.css("min-height")?.replace("px",""))};if(o.x+s.width/2<0||o.x-s.width/2>window.innerWidth||o.y+s.height/2<0||o.y-s.height/2>window.innerHeight)return true}function Yi(){for(const i of document.getElementsByClassName("mpob")){const o=i;const s={prev:o.getAttribute("prout"),now:false};const c=Ce(o);var e="";const r={x:(c.x-T.canvas.coords.x)*a,y:(c.y-T.canvas.coords.y)*a};var t=Le(o);const d=Ie(o);var n=Object.create(d);if(t=="dynamic"){if(a>O.object.dynamic_to_static.over)t="dynatic";if(a<O.object.dynamic_to_static.under)t="_dynatic"}switch(t){case"static":n.width=d.width*a;n.height=d.height*a;break;case"dynatic":n.width=d.width*(a/O.object.dynamic_to_static.over);n.height=d.height*(a/O.object.dynamic_to_static.over);break;case"_dynatic":break;n.width=d.width*(a/O.object.dynamic_to_static.under);n.height=d.height*(a/O.object.dynamic_to_static.under);break;case"dynamic":n.width=d.width;n.height=d.height;break}e+=`translate(${r.x}px, ${r.y}px)`;if(r.x+n.width<0||r.x-n.width>window.innerWidth||r.y+n.height<0||r.y-n.height>window.innerHeight){if(s.prev)continue;else o.setAttribute("prout","true")}else if(s.prev){o.removeAttribute("prout")}o.style.transform=e;$($(o).children()[0]).css("min-width",n.width+"px").css("min-height",n.height+"px")}}function qi(){const e=K[se]||[];for(const t of e){ei(t.coords,t.name)}}function Ji(e){const t=document.getElementById(Ee(ve,e));return t?t:null}function zi(e,t){const n=Ji(e)}function Vi(e){const t=Ji(e);if(t){const e=t.children[0];e.classList.add("mpob-clerdd");e.classList.remove("_","favoritE");e.classList.add("cleareD")}}function Ki(e,t){const n=Ji(e);if(t==0)t=1;if(n){const e=n.children[0];if(e.querySelectorAll(`.crowds-${t}`).length>0)return;e.querySelectorAll(".AUIHVP").forEach((e=>e.remove()));$(e).prepend(`<div class="AUIHVP kpls"><span class="crowds-${t}"></span></div>`)}}function Zi(e,t){const n=Ji(e);if(n){const e=n.children[0];if(e.querySelectorAll(".NJIvua").length>0)return;$(e).prepend(`<div class="NJIvua kpls"><span>${t}</span></div>`)}}function Qi(e){const t=Ji(e);if(t){const e=t.children[0];if(e.querySelectorAll(".AIGbbvwG").length>0)return;$(e).prepend(`<div class="AIGbbvwG kpls"><span></span></div>`)}}function eo(e){const t=Ji(e);if(t){const e=t.children[0];e.classList.remove("favoritE","cleareD");e.classList.add("_")}}function to(){const e=Math.ceil(l.data.completed_orgs.length/k*100);var t="";var n=false;if(e==100){t="#4CAF50"}else if(e>=75){t="#C0CA33"}else if(e>=50){t="#FDD835"}else if(e>=25){t="#F4511E"}else if(e>=0){t="#E53935"}if(l.data.completed_orgs.length>=13){n=true;t="#4CAF50";$("#oive_r").css("width","340px").css("height","60px").css("top","calc(100dvh - 70px)");$("#oive_h").css("padding","0 10px");$("#auyGAWW").text(`2階職員室前の面談室5 へおこしください！ペンを贈呈致します ${e}% (${l.data.completed_orgs.length}/${k})`)}else{$("#auyGAWW").css("color",t).text(`${e}% (${l.data.completed_orgs.length}/${k})`)}}function no(e){console.log(e);const t=ke.string(8);const n=e["object"]?.["floor"]??e["floor"];he.length=0;he.push(t);O.deny=true;function i(){const n=.25;const i=ge;const o=3e3/5;const s=li([window.innerWidth/2,window.innerHeight/2]);const c={zoom1:n<a?(n-a)/(o/3):0,zoom2:(i-n)/(o/3),pos:{x:((e["object"]?.["coordinate"]?.["x"]??e["x"])-s.x)/(o*(2/3)),y:((e["object"]?.["coordinate"]?.["y"]??e["y"])-s.y)/(o*(2/3))}};var r=0;function d(){r++;if(r>o){hi();O.deny=false;return}if(r<o/3)a+=c.zoom1;if(r>o*(3-1)/3)a+=c.zoom2;if(r<o*(2/3)){s.x+=c.pos.x;s.y+=c.pos.y}fi(s,a);he.includes(t)?setTimeout(d,5):void 0}d()}if(se==(e["object"]?.["floor"]??e["floor"])){i()}else{const e=oe[n];po(n,n,e).then(i)}}class oo{static fullyopened=false;static status="closed";static reduceCoro=[];static get isfullyopened(){return this.fullyopened}static get currentstatus(){return this.status}}function so(){const t=document.getElementById("shishiji-overview");const n=$(t);ao();oo.status="opening";t.style.top="0vh";n.show().removeClass("reducedown").addClass("raiseup").scrollTop(0);$("#overview-close-w").show();setTimeout((()=>{oo.fullyopened=true;oo.status="opened";n.removeClass("raiseup")}),500);w.favorite=w.vote=()=>void 0;w.close=ro;w.share=function t(){const n=Xe(me.ARTICLE_ID);const i=Pe(n||"");const o=new URL(window.location.href);var s=`${o.origin}${o.pathname.replace(/@.*/,"")}?${me.FLOOR}=${se}&${me.ARTICLE_ID}=${n}`;if(i==null||n==null){console.log(i,n);vo({title:""},"",{},"","",{labelkey:"",url:""},true);return}const a=`${TEXTS[e].SHARE_EVENT_MESSAGE} ${i.article.title}`;vo({title:TEXTS[e].SHARE_EVENT_POPUP_TITLE,subtitle:TEXTS[e].SHARE_EVENT_POPUP_SUBTITLE},s,{title:TEXTS[e].SHARE_EVENT_DATA_TITLE,text:`${a}\n{__SHARE_URL__}`},pe.FROM_ARTICLE_SHARE,a,{labelkey:"SHARE_EVENT_INCLUDE_EVTH",url:`${s}&${me.SCROLL_POS}=${$("#shishiji-overview").scrollTop()}&${me.ART_TARGET}=${$(".tg-active")[0].id.match(/ovv-t-(.*?)-sd/)?.[1]}`})}}function ao(){clearInterval(J.reduceOverview);$("#user-stricter").removeClass("deactive").addClass("active")}function co(){clearTimeout(J.restrict);$("#user-stricter").removeClass("active").addClass("deactive")}function ro(){const e=document.getElementById("shishiji-overview");const t=$(e);if(y.article)return;co();oo.fullyopened=false;oo.status="closing";e.style.top="100vh";t.removeClass("raiseup").addClass("reducedown");$("#overview-close-c").off("click",ro);$("#overview-context").removeClass("fadein");$(".tg-active").removeClass("tg-active");$("#dvd2").removeClass("ihateky");$("#theme-meta").attr("content","#15202b");oo.reduceCoro.forEach((e=>e()));oo.reduceCoro.length=0;J.reduceOverview=setTimeout((()=>{oo.status="closed";$("#ev_property").empty();$("#--art-header").attr("src","");t.css("border-top","20px solid white").removeClass("reducedown").scrollTop(0).hide()}),150);He(me.ARTICLE_ID)}function lo(t,n,i,o,s,a){const c=document.getElementById("shishiji-overview");const r=t.article.theme_color?t.article.theme_color:"black";const d=t.article.font_family?t.article.font_family:"";const u=t.discriminator;const h=Ve(t);const f=[];const m=$.post(ajaxpath.getart+"?discriminator="+t.discriminator,{discriminator:t.discriminator});const p=setTimeout((()=>at("loading-article-"+t.discriminator,"middle")),500);var v="";var g="";var _=0;m.then((n=>{const i=n.article;const o=n.crowd;const s=n.pt;const a=t.object.no_admission?document.createElement("span"):ft("訪問pt",s.toString()+"pt");const c=ft("混雑状況",q[o]);$(".ev_property").prepend(a,c);g+=a.outerHTML+c.outerHTML;v=It(i,(e=>h(u,e)));if(v==="<span></span>"){v=`<h4 style="width:100%;margin-top:50px;margin-bottom:50px;text-align:center;">${TEXTS[e].ARTICLE_NO_ARTICLE}</h4>`}$("#ARTICLE_UNKO").html(v)})).catch((()=>_o.notifyError(TEXTS[e].FAILED_TO_LOAD_ARTICLE_CONTENT))).always((()=>{ct("loading-article-"+t.discriminator,"middle");clearTimeout(p)}));if(yt("article")){y.article=true;setTimeout((()=>Et("article")),500)}for(const S of t.article.custom_tr){if(S.title&&S.content)g+=ft(S.title,S.content).outerHTML}g+=ft("開催場所",t.article.venue).outerHTML;if(n)$("#ctx-article").addClass("fadein");c.style.borderTop="solid var(--shishiji-ovv-theme-height) "+r;$(c).css("font-family",d);$("#dvd4 > span").text(TEXTS[e].SHARE);$("#dvd1 > span").text(TEXTS[e].REVEAL_ON_MAP);$("#dvd2 > span").text(TEXTS[e].FAVORITE);$("#dvd3 > span").text(TEXTS[e].VOTE);$("#ovv-ctx-loading-w").remove();$("#ctx-title").text(t.article.title);setTimeout((()=>$("#theme-meta").attr("content",r)),500);l.data.favorited_orgs.includes(u)?$("#dvd2").addClass("ihateky"):$("#dvd2").removeClass("ihateky");l.data.completed_orgs.includes(u)?(()=>{$("#dvd3").show().removeClass("uihGAV")})():(()=>{$("#dvd3").show().addClass("uihGAV");w.vote=()=>{_o.notifyInfo(TEXTS[e].VOTE_AVAILABLE_AFTER_VISITING)}})();z={deled:null,feels:[...l.data.favorited_orgs]};function E(){const e=t.discriminator;const n=[...l.data.favorited_orgs];var i=false;at("favud","top");if(l.data.favorited_orgs.includes(e)){$("#dvd2").removeClass("ihateky");l.data.favorited_orgs=l.data.favorited_orgs.filter((t=>t!==e));i=true}else{$("#dvd2").addClass("ihateky");l.data.favorited_orgs.push(e)}Fi();clearTimeout(J.ogfav);J.ogfav=setTimeout((()=>x(i,n)),500)}function x(t,n){$.post(ajaxpath.updfav,{favorites:JSON.stringify(l.data.favorited_orgs)}).then((()=>{Fi();z={deled:t,feels:[...l.data.favorited_orgs]}})).catch((()=>{_o.notifyError(TEXTS[e].ERROR_ANY,{do_not_keep_previous:true});l.data.favorited_orgs=[...z.feels];z!==null?z.deled?$("#dvd2").addClass("ihateky"):$("#dvd2").removeClass("ihateky"):void 0;Fi()})).always((()=>ct("favud","top")))}function b(){ro();mn([u])}function T(){setTimeout((()=>{$("#ctx-article").addClass("_fadein");if(i!==void 0)$("#shishiji-overview").scrollTop(i);i=0}),25)}function C(){$(this).attr("draggable","false")}class k{static get exists(){return true}static async write(e,t,n){const i=document.getElementById("ctx-article");const o=document.createElement("span");o.innerHTML=e;if(n){const e={};for(const t of n){const n=t.src||"";if(e[n])e[n].push(t);else e[n]=[t]}for(const t of[...o.querySelectorAll("img"),...o.querySelectorAll("video")]){const n=t.src||"";const i=e[n];const o=i?.length>0?i[0]:t.cloneNode(true);t.parentNode?.replaceChild(o,t);o.style.width=t.style.width;e[n]=e[n]?.filter((e=>e!==o))}}if(i){i.innerHTML="";i.appendChild(o)}if(t)t()}}function L(){$(".tg-active").removeClass("tg-active");$(this).addClass("tg-active");$(".article-image").addClass("doaJSD");$("#--art-header").attr("src",h(u,t.article.images.header));$("#--art-icon").attr("src",h(u,t.object.images.icon));C.call($("#--art-header"));C.call($("#--art-icon"))}function I(){if($(this).hasClass("tg-active")&&!s)return;$("#ctx-article").addClass("_wait_f");function e(){if(f.length==0){document.getElementById("ctx-article")?.querySelectorAll("img").forEach((e=>f.push(e)));document.getElementById("ctx-article")?.querySelectorAll("video").forEach((e=>f.push(e)))}setTimeout((()=>$("#shishiji-overview").scrollTop(_)),25)}const i=t.object.no_admission?`<span class="saioguW">※この団体には入場記録がなく、訪問ptももらえません</span>`:"";k.write(`${i}<div id="ARTICLE_UNKO">${v}</div>`,T,f).then(e);if(n)$("#ctx-article").removeClass("fadein").removeClass("_fadein");L.call(this)}function A(){if($(this).hasClass("tg-active")&&!s)return;_=$("#shishiji-overview").scrollTop()||0;$("#ctx-article").addClass("_wait_f");const e=`\n            <hr style="margin: 40px 20px 20px 20px;">\n            <div class="ev_property">\n                <table style="width: 100%;">\n                    <tbody>\n                        ${g}\n                    </tbody>\n                </table>\n            </div>\n            <hr style="margin: 20px;">\n            `;k.write(e,T);$("#ctx-article").removeClass("fadein").removeClass("_fadein");L.call(this)}$("#ovv-t-description-sd").off("click",we.description).on("click",I);$("#ovv-t-details-sd").off("click",we.details).on("click",A);we.description=I;we.details=A;w.favorite=E;l.data.completed_orgs.includes(u)?w.vote=b:void 0;if(!o||!["description","details","else"].includes(o))o="description";document.getElementById(`ovv-t-${o}-sd`)?.dispatchEvent(new Event("click"));if(a){$("#dvd1").show();function O(){if(an.opened)an.close();ot();w.close(new Event("Avada Kedavra"));$("#overview-gogow-w").off("click",O);setTimeout((()=>{no(t)}),250)}Z=O}else{$("#dvd1").hide()}}async function uo(e,t){new Promise(((t,n)=>{$("#overview-context").html(e);t("")})).then((()=>{if(t!==void 0)t()}))}function ho(e,t){if(!e){this.removeClass("toSel undoSel").addClass("toSel popped");$("#place-options-w").show().removeClass("toSel undoSel").addClass("toSel");$("#where_am_i").hide();$("#psdummy").addClass("greatfulmanbruh")}else{this.removeClass("popped").addClass("undoSel");if(t)$("#place-options-w").hide();else $("#place-options-w").show();$("#place-options-w").removeClass("toSel").addClass("undoSel");$("#where_am_i").show();$("#psdummy").removeClass("greatfulmanbruh")}}function fo(e){if(e===void 0)e=se;$(".fselc-cell").removeClass("currentflr");$("#floor-"+e).addClass("currentflr")}function mo(){if(se=="B1")O.caps.ratio.min=.4;else O.caps.ratio.min=.15}async function po(t,n,i,o){const s=document.getElementById("#place-selector".slice(1));const c=await Oe(TEXTS[e].LOADING_MAP,void 0,o);ae.fselector.opened=false;se=t;mo();const r={width:i.tile_width*(i.xrange+1),height:i.tile_height*(i.yrange+1)};oe[se]=pi(i);Be(me.FLOOR,se);fo();return new Promise((async(o,s)=>{mi(i,{over:"",under:n},(function(){const n={width:(i.xrange+1)*i.tile_width,height:(i.yrange+1)*i.tile_height};const s=[document.body.clientWidth/n.width,document.body.clientHeight/n.height];T.canvas.coords={x:0,y:0};a=Math.min(...s);_i({left:0,top:0});Di();Xi(t,V);Fi();hi();fi({x:(i.xrange+1)*i.tile_width/2,y:(i.yrange+1)*i.tile_height/2},void 0,true);Ne(TEXTS[e].MAP_LOADED,0).then(o)}))}))}function vo(t,n,i,o,s,a,c){yo.startLoad();n=decodeURIComponent(n);function r(t){if(t===void 0)t=TEXTS[e].ERROR_ANY;_o.notify("error",TEXTS[e].NOTIFICATION_ERROR_ANY,{do_not_keep_previous:true,duration:2500,discriminator:"sharePopup connection error"});if(yo.isPoppingup)yo.showasError(t)}function d(e,t,n){return e.includes("?")?`${e}&${t}=${n}`:`${e}?${t}=${n}`}$.ajax({url:"/share_panel",method:"GET",timeout:3e4,dataType:"html"}).done((l=>{if(yo.isPoppingup){yo.popupContent(l,(function(){const l=d(n,me.URL_FROM,o);var u=[];var h={share:()=>{},copy:()=>{}};if(c){r();return}$("#ppc-title").text(t.title);if(t.subtitle)$("#ppc-subtitle").text(t.subtitle);function f(e){if(window.navigator.share){i.text=i.text?.replace("{__SHARE_URL__}",e||l);!function(e){async function t(){await window.navigator.share(e)}$("#share-nav").off("click",h.share).on("click",t);h.share=t;return 0}(i)}else{$("#nav-share").remove()}}f();function m(t){function n(){window.navigator.clipboard.writeText(t||l);_o.notify("link",TEXTS[e].NOTIFICATION_COPIED_LINK,{duration:2500,discriminator:"copy artshare"})}$("#share-copy").off("click",h.copy).on("click",n);h.copy=n}m();if(a){$("#includeScr").text(TEXTS[e][a.labelkey]);$("#includeScrCh").on("change",(function(e){if(this.checked){for(var t=0;t<document.getElementsByClassName("share_ebtn").length;t++){$(document.getElementsByClassName("share_ebtn")[t]).off("click",u[t])}const e=d(a.url,me.URL_FROM,o);p(e);f(e);m(e)}else{p();f();m()}}))}else{$("#includeScrCh").remove()}s=encodeURIComponent(s);function p(t){const n=encodeURIComponent(t||l);const i=`${s}%0A${n}`;u=[];for(const e of document.getElementsByClassName("share_ebtn")){const t=e.id.replace("share-","");const a=$(e);var o="";switch(t){case"line":o=`http://line.me/R/msg/text/?${i}`;break;case"twitter":o=`https://x.com/intent/tweet?url=${n}&text=%0A%0A${s}%0A${encodeURIComponent("#獅子児祭 @shishijifes")}%0A&related=shishiji`;break;case"facebook":o=`http://www.facebook.com/share.php?u=${n}`;break;case"gmail":$("#share-gmail").parent().parent().remove();o=`https://mail.google.com/mail/?view=cm&body=%0A%0A${i}`;break;case"mail":o=`mailto:?body=%0A%0A${i}`;break;case"sms":o=`sms:?body=%0A%0A${i}`;break;case"whatsapp":o=`https://api.whatsapp.com/send?text=${i}`;break;default:continue}!function(e){function t(){window.open(e,"_blank")}a.on("click",t);u.push(t);return 0}(o)}function a(){$("#--share-bru").text("Share");$("#--trans-MAIL").text("Email");$("#--trans-MESSAGE").text("Messages");$("#--trans-COPYLINK").text("Copy Link");$("#--trans-OTHERS").text("Others")}if(e!="JA")a()}p()}),{height:360})}})).catch((()=>r()))}const go=class e{static _pending_notices=[];static _prop={Timeout:0,_Timeout:0,__Timeout:0,current:"",notifying:false};static notifyHTML(t,n){this._invoke.call(e,[t,n],false)}static get current(){return this._prop.current}static get isNotifying(){return document.getElementById("--yd-notifier")?.classList.contains("vpopen")}static _invoke(...e){const t=e[0];var n=t[0],i=t[1],o=i?.duration,s=i?.discriminator,a=e[1];const c=$("#--yd-notifier");const r=document.createTextNode(n).textContent;o??=3e3;s??=n;if(this._prop.notifying&&this._prop.current==s&&!i?.do_not_keep_previous)return;if(r?.endsWith(".")||r?.endsWith("!")||r?.endsWith("?"))n+="&nbsp;";if(!a)this.clearPengings();this._prop.current=s;clearTimeout(this._prop.Timeout);clearTimeout(this._prop._Timeout);clearTimeout(this._prop.__Timeout);if(this._prop.notifying){this.closeNotifier(true);this._prop._Timeout=setTimeout((()=>{d.apply(this,[i?.deny_userclose])}),75);return}function d(e){$("#--ott-us").html(n);c.show().removeClass("hpipe").addClass("vpopen");if(!e){this._add_closeOnInter()}else{c.addClass("--path-through")}this._prop.notifying=true;if(o!==Infinity)this._prop.Timeout=setTimeout((()=>{this.closeNotifier(true)}),o)}d.apply(this,[i?.deny_userclose])}static closeNotifier(t){clearTimeout(this._prop.__Timeout);$("#--yd-notifier").removeClass("--path-through").removeClass("vpopen").addClass("hpipe");this._removeCloseonInter();this._prop.notifying=false;this._prop.__Timeout=setTimeout((()=>{$("#--ott-us").empty();$("#--yd-notifier").hide();if(!t)this._prop.current="";if(e._pending_notices.length>0)this._invoke_pending()}),70)}static appendPending(t){e._pending_notices.push(t);if(!this.isNotifying)this._invoke_pending()}static clearPengings(){e._pending_notices=[]}static _invoke_pending(){const t=e._pending_notices[0];this._invoke.call(e,[t.html,t.options],true);e._pending_notices.shift()}static _add_closeOnInter(){const e=$("#--yd-notifier");e.removeClass("--path-through").on("touchstart mousedown",this._interClose)}static _removeCloseonInter(){const e=$("#--yd-notifier");e.off("touchstart mousedown",this._interClose)}static _interClose(t){t.preventDefault();e.closeNotifier()}};const _o=class e extends go{static tagName="shishiji-yd-notifier-cd";static baseComponent=`<${this.tagName} id="{id}" class="protected flxxt" style="font-size:12px;">{svg}<span>{message}</span></${this.tagName}>`;static _tagName="picton-icon-svg";static _images=["info","link","no-wifi","success","warn","error","save","input","school","zoom","smile","new","calculating","copy","thanks"];static _imagepath="/resources/svg/{name}.svg";static notify(e,t,n){var i="";var o=(e,t)=>"";switch(e){default:break;case"no-wifi":!i?i=GPATH.NO_WiFi:void 0;case"info":case"link":o=this._cpylinnot;break;case"success":case"warn":o=this._shrf;break;case"error":!i?i=GPATH.ERROR:void 0;o=this._shrnf;break;case"save":case"input":case"smile":case"thanks":o=this._shrf;break;case"zoom":case"new":case"calculating":o=this._shref;break;case"copy":o=this._shreRf}if(i)t=o.call(this,i,t);else t=this._useImg(e,t,o);if(n?.addToPending)this.appendPending.call(go,{html:t,options:n});else this.notifyHTML(t,n)}static notifyInfo(...e){e[0]=this._useImg("info",e[0],this._cpylinnot);this.notifyHTML(...e)}static notifySuccess(...e){e[0]=this._useImg("success",e[0],this._shrf);this.notifyHTML(...e)}static notifyError(...e){e[0]=this._shrnf(GPATH.ERROR,e[0]);this.notifyHTML(...e)}static notifyLink(...e){e[0]=this._useImg("link",e[0],this._cpylinnot);this.notifyHTML(...e)}static notifyNoWiFi(...e){e[0]=this._cpylinnot(GPATH.NO_WiFi,e[0]);this.notifyHTML(...e)}static notifyWarn(...e){e[0]=this._useImg("warn",e[0],this._shrf);this.notifyHTML(...e)}static notifySave(...e){e[0]=this._useImg("save",e[0],this._shrf);this.notifyHTML(...e)}static notifyInput(...e){e[0]=this._useImg("input",e[0],this._shrf);this.notifyHTML(...e)}static notifyZoom(...e){e[0]=this._useImg("zoom",e[0],this._shref);this.notifyHTML(...e)}static _getImg(t){const n=document.createElement("img");n.src=e._imagepath.replace("{name}",t);return n}static _appendPisElement(t,n){const i=document.createElement(e._tagName);const o=document.createElement("img");o.src=n;o.loading="lazy";i.appendChild(o);i.classList.add("shy");i.setAttribute("name",t);document.body.appendChild(i);return i}static _getComponent(e,t,n){return this.baseComponent.replace("{id}",e).replace("{svg}",t).replace("{message}",n)}static _cpylinnot(e,t){return this._getComponent("cpy-lin-not",e,t)}static _shrf(e,t){return this._getComponent("shr-f",e,t)}static _shrnf(e,t){return this._getComponent("shr-notf",e,t)}static _shref(e,t){return this._getComponent("shr-exf",e,t)}static _shreRf(e,t){return this._getComponent("shr-eRxf",e,t)}static _useImg(e,t,n){const i=this._getImg(e);const o=document.createElement("div");o.innerHTML=n.call(this,"",t);o.children[0].prepend(i);return o.innerHTML}};const wo=class e{static _pending_notices=[];static _prop={Timeout:0,_Timeout:0,__Timeout:0,current:"",notifying:false};static _pray=false;static currentClickListener=()=>{};static notifyHTML(t,n){this._invoke.call(e,[t,n],false)}static get current(){return this._prop.current}static get isNotifying(){return document.getElementById("raid--yd-notifier")?.classList.contains("vpopen")}static _invoke(...e){const t=e[0];var n=t[0].event_details,i=t[1],o=i?.duration,s=i?.discriminator,a=e[1];const c=$("#raid--yd-notifier");var r=Pe(t[0].discriminator);o??=3e3;s??=ke.string(10);this._prop.current=s;clearTimeout(this._prop.Timeout);clearTimeout(this._prop._Timeout);clearTimeout(this._prop.__Timeout);if(this._prop.notifying){this.closeNotifier(true);this._prop._Timeout=setTimeout((()=>{d.apply(this,[i?.deny_userclose])}),105);return}function d(e){if(r==null||t[0].no_relation){$("#aaGWUIJO").text(t[0].discriminator);$("#AuSAJIg").attr("src",t[0].image_src||"")}else{const i=r;function s(){Be(me.ARTICLE_ID,i.discriminator);so();lo(i,true,void 0,void 0,void 0,true)}$("#aaGWUIJO").text(r?.article?.title||"");$("#AuSAJIg").attr("src",Je(r.discriminator,r.object.images.icon));$("#raid--yd-notifier").off("click",this.currentClickListener);$("#raid--yd-notifier").on("click",s);this.currentClickListener=s}$("#auijsmjmg").text(t[0].time);$("#asGUOt").html(n);c.show().removeClass("hpipe").addClass("vpopen");if(!e){this._add_closeOnInter()}else{c.addClass("--path-through")}this._prop.notifying=true;if(o!==Infinity)this._prop.Timeout=setTimeout((()=>{this.closeNotifier(true)}),o)}d.apply(this,[i?.deny_userclose])}static closeNotifier(t){clearTimeout(this._prop.__Timeout);$("#raid--yd-notifier").removeClass("--path-through").removeClass("vpopen").addClass("hpipe");this._removeCloseonInter();this._prop.notifying=false;this._prop.__Timeout=setTimeout((()=>{$("#raid--yd-notifier").hide();if(!t)this._prop.current="";if(e._pending_notices.length>0)this._invoke_pending()}),101)}static appendPending(t){e._pending_notices.push(t);if(!this.isNotifying)this._invoke_pending()}static clearPengings(){e._pending_notices=[]}static _invoke_pending(){const t=e._pending_notices[0];this._invoke.call(e,[t.html,t.options],true);e._pending_notices.shift()}static _add_closeOnInter(){const e=$("#raid--yd-notifier");e.removeClass("--path-through");if(!this._pray){st(document.getElementById("raid--yd-notifier")||HTMLElement.prototype,this._interClose);this._pray=true}}static _removeCloseonInter(){const e=$("#raid--yd-notifier")}static _interClose(t){e.closeNotifier()}};window.RaidNotifier=wo;const yo=class e{static closeKeys=["ESCAPE"];static closeListeners=[];static async popupContent(e,t,n){const i=GPATH.X;if(n===void 0){n={width:500,height:450}}else{if(!n.width)n.width=500;if(!n.height)n.height=450}if(n.hideclosebutton&&n.forceclosebutton)console.warn("hideclosebutton and forceclosebutton shouldn't be true at same time!!");if(!n.hideclosebutton)e=i+e;window.removeEventListener("keydown",this._keydisposal);$("shishiji-mx-overlay").off("click",this._dispose);return new Promise(((t,i)=>{if(!n?.forceclosebutton){window.addEventListener("keydown",this._keydisposal);$("shishiji-mx-overlay").on("click",this._dispose)}$("shishiji-mx-overlay").removeClass("pipe").addClass("popen");$("#shishiji-popup-container-c").removeClass("flxxt").css({overflow:"",height:"",width:"","max-width":n.width+"px","max-height":n.height+"px",left:`calc((var(--window-width) - 48px - min(${n.width}px, var(--window-width) - 48px))/2)`}).html(e).show();t("")})).then((()=>{$("#ppcls").on("click",this._disposition);if(t!==void 0)t()}))}static async popupMedia(e,t,n,i){const o=GPATH.X;const s=n?n.cloneNode(true):document.createElement("span");var a=o;if(s){$(s).attr("id","").attr("class","").attr("style","").attr("draggable","true");switch(t){case"video":$(s).attr("controls","").attr("preload","metadata").attr("playsinline","").attr("autoplay","").removeAttr("muted");default:s.classList.add("suhDWAgd")}}else{switch(t){case"img":a+=`<img class="suhDWAgd" src="${e}" draggable="true">`;break;case"video":a+=`<video class="suhDWAgd" src="${e}" controls preload="metadata" playsinline="" draggable="true"></video>`;break}}return new Promise(((e,t)=>{window.addEventListener("keydown",this._keydisposal);$("shishiji-mx-overlay").removeClass("pipe").addClass("popen").on("click",this._dispose);$("#shishiji-popup-container-c").addClass("flxxt").css({"max-height":"fit-content",height:"fit-content",overflow:"visible"}).html(a).append(s).show();e("")})).then((()=>{$("#ppcls").css({top:"-40px",right:"0"}).on("click",this._disposition);$($($("#ppcls").children()[0]).children()[0]).attr("fill","blue");if(i!==void 0)i()}))}static startLoad(e){this.popupContent(`<div class="protected" id="ppupds"><div class="mx-text-center flxxt">${re.loadging}</div></div>`,(()=>{}),e)}static showasError(e){this.popupContent(`<div class="protected" id="ppupds"><div class="mx-text-center flxxt" style="flex-direction:column;"><div style="width:125px;margin-bottom:4px;">${GPATH.ERROR_ZAHUMARU}</div><h4>${e}</h4></div></div>`)}static disPop(t){if(typeof t!=="string")t="JAVASCRIPT";window.removeEventListener("keydown",e._keydisposal);$("#ppcls").off("click",e._disposition);$("shishiji-mx-overlay").removeClass("popen").addClass("pipe").off("click",e._dispose);$("#shishiji-popup-container-c").hide().empty();e._callCloseListeners(t)}static get isPoppingup(){const e=document.getElementById("shishiji-popup-container-c");return e?.clientHeight!=0?true:false}static setsize(){const e=$("#shishiji-popup-container-c");function t(e){return Number(e.replace("px",""))}const n={width:t(e.css("width")),height:t(e.css("height")),margin:t(e.css("margin"))};var i=t(e.css("width"));var o=t(e.css("height"));var s=t(e.css("margin"));if(window.innerWidth<=i+s*2){e.css("width",window.innerWidth-s*2+"px");i=window.innerWidth-s*2}else{e.css("width",n.width+"px")}e.css("top",(window.innerHeight-(s*2+o))/2+"px").css("left",(window.innerWidth-(s*2+i))/2+"px")}static addCloseListener(e){this.closeListeners.push(e)}static removeCloseListener(e){const t=this.closeListeners.length;this.closeListeners=this.closeListeners.filter((t=>t!==e));if(this.closeListeners.length<t)return true;else return false}static _difficult(t){if(e.isPoppingup)e.disPop(t)}static _dispose(){e._difficult("OVERLAY")}static _disposition(){e.disPop("X BUTTON")}static _keydisposal(t){const n=t.key.toUpperCase();if(e.closeKeys.includes(n)){e._difficult("KEYBOARD")}}static _callCloseListeners(e){this.closeListeners.forEach((t=>{t(e)}))}};window.Popup=yo;function Eo(e){if(y.pkgo)return;setTimeout((()=>an.close.call(window,true)),100);e()}function $o(e){return()=>Eo(e)}document.getElementById("pkgo_menu5")?.children[0].addEventListener("click",$o(Wt));document.getElementById("pkgo_menu3")?.children[0].addEventListener("click",$o(xn));document.getElementById("pkgo_menu1")?.children[0].addEventListener("click",$o(Xn));document.getElementById("pkgo_menu2")?.children[0].addEventListener("click",$o(fn));document.getElementById("pkgo_menu6")?.children[0].addEventListener("click",$o(Bn));document.getElementById("pkgo_menu7")?.children[0].addEventListener("click",$o(Nn));document.getElementById("pkgo_menu4")?.children[0].addEventListener("click",$o(Hn));document.getElementById("pkgo_menuXXL")?.children[0].addEventListener("click",$o(sn));document.getElementById("pkgo_menuXXS")?.children[0].addEventListener("click",$o(jn));document.getElementById("user-profile-opner")?.addEventListener("click",$o(dn));document.getElementById("bandeventopen")?.addEventListener("click",$o(bn("band")));document.getElementById("danceeventopen")?.addEventListener("click",$o(bn("dance")));document.getElementById("misceventopen")?.addEventListener("click",$o(bn("misc")));document.getElementById("go_to_ranking")?.addEventListener("click",$o(qn));document.getElementById("gt_mps")?.addEventListener("click",Ft);document.getElementById("ag8FOKSpoa")?.addEventListener("click",zn);document.getElementById("famevotegogo")?.addEventListener("click",$o(mn));document.getElementById("eventvotegogo")?.addEventListener("click",$o($n));document.getElementById("bandeventopen_")?.addEventListener("click",$o(In("band")));document.getElementById("danceeventopen_")?.addEventListener("click",$o(In("dance")));document.getElementById("misceventopen_")?.addEventListener("click",$o(Ln));document.getElementById("gos_budozyo")?.addEventListener("click",$o(In("misc","武道場")));document.getElementById("gos_houkou")?.addEventListener("click",$o(In("misc","放光館")));document.getElementById("gos_syudou")?.addEventListener("click",$o(In("misc","修道館ホール")));document.getElementById("gos_kousyamae")?.addEventListener("click",$o(In("misc","校舎前")));["click"].forEach((e=>{document.getElementById("pkgo_mainb")?.addEventListener(e,(function(){if(y.main_screen)return;an.oepn();if(yt("menu")){y.pkgo=true;setTimeout((()=>Et("menu")),500)}}));document.getElementsByTagName("pokemon-gradient")[0].addEventListener(e,(function(){!y.pkgo?an.close():void 0}));document.getElementById("pkgo_menu_closeAWW")?.addEventListener(e,(function(){!y.pkgo?an.close():void 0}))}));+function(){const e=document.createElement("shishiji-pkgo-close"),t=document.createElement("aoish-s");t.classList.add("flxxt");e.classList.add("flxxt","protected");e.appendChild(t);const n=document.createElement("div");n.classList.add("particular_closebwrap","manyyearshaspassed");const i=["vote_screen","fame_vote_screen","event_vote_screen","event_vote_selector_screen"];function o(){if(y.pkgo||y.article)return;const e=ke.string(6);const t=this.classList.contains("particular_closebwrap")?this.parentElement?.parentElement?.id:this.parentElement?.id;it(t||"");if(this.classList.contains("particular_closebwrap"))return;$("#shpkgoanim").append(`<daoijh id="${e}"><close-outside></close-outside><close-inside class="shishijineon"></close-inside></daoijh>`);setTimeout((()=>$("#"+e).remove()),501)}for(const t of document.getElementsByTagName("shishiji-pks")){if(t.id=="headcount_screen")continue;if(i.includes(t.id)){const e=n.cloneNode(true);$(e).attr("id","close_button_of_"+t?.id);e.addEventListener("click",o);t.querySelector(".AGDaewP")?.appendChild(e)}else{const n=e.cloneNode(true);$(n).attr("id","close_button_of_"+t?.id);n.addEventListener("click",o);if(t.id=="stamp_rally_screen")n.addEventListener("click",(async function(){await Vn()?_t("1"):wt("1")}));t?.appendChild(n)}}document.getElementById("overview-close-c")?.addEventListener("click",(function(){o.call(this);w.close()}))}();document.getElementById("close_button_of_stamp_rally_scan_screen")?.addEventListener("click",(function(){const e=document.getElementById("qrcode-video");e.srcObject=null;tn.forEach((e=>{e.getTracks().forEach((e=>e.stop()))}));tn.length=0;ct("opening camera","middle")}));document.getElementById("showshop")?.addEventListener("click",(function(){ot();setTimeout((()=>{no(V["shop"])}),500)}));document.getElementById("icon-chd")?.addEventListener("click",(()=>$("#chiconinputimgae").trigger("click")));document.getElementById("chiconinputimgae")?.addEventListener("change",ln);document.getElementById("iasyguf")?.addEventListener("click",un);+function(){function e(){if($(this).val()?.toString().length==0)Vt(false);else Qt()}document.getElementById("del_search")?.addEventListener("click",(function(){$("#org_search_input").val("");Vt(false)}));document.getElementById("fav_search")?.addEventListener("click",(function(){const e=this.getAttribute("fav_search");if(e){$(this.children[0]).show();$(this.children[1]).hide();this.removeAttribute("fav_search")}else{$(this.children[0]).hide();$(this.children[1]).show();this.setAttribute("fav_search","true")}Jt()}));document.getElementById("do_search")?.addEventListener("click",(function(){e.call($("#org_search_input"))}));document.getElementById("org_search_input")?.addEventListener("keydown",(function(t){if(t.key.toUpperCase()=="ENTER"){t.preventDefault();e.call(this)}}))}();document.getElementById("aiUHGG")?.addEventListener("click",_n);async function xo(){const e={};for(const t of Object.keys(V)){await $.post(ajaxpath.getart+"?discriminator="+t).then((n=>{const i=n.article;const o=tt(It(i,(()=>"")));e[t]=o}))}console.log(e)}+function(){for(const e of document.getElementsByClassName("faq_sec")){e.addEventListener("click",(function(){const e=$(this).attr("about");$("#faq_question_title").text(this.textContent);$("#faq_answers").empty();nt("faq_answer_screen");at("faq,"+e,"middle");const t=()=>$.post(ajaxpath.faq,{about:e}).then((t=>{ct("faq,"+e,"middle");$("#faq_answers").html(t)})).fail((t=>{ct("faq,"+e,"middle");$("#faq_answers").text(t.responseText)}));setTimeout(t,250)}))}}();function bo(e){e.key.toUpperCase()=="ENTER"?e.preventDefault():void 0}function To(){const e=$(this).val();ye.situation.nickname=e==l.data.profile.nickname?false:true}function Co(){if($("#vote_right_now").attr("wait"))return;const t=[...hn];at("famevote","middle");$("#vote_right_now").attr("wait","true");$.post(ajaxpath.updfvote,{votes:JSON.stringify(t)}).then((()=>{const t=[...l.data.fame_votes];l.data.fame_votes=[...hn];if(t.length>0&&l.data.fame_votes.length>0)_o.notifySuccess(TEXTS[e].VOTE_CHANGED,{do_not_keep_previous:true});else if(l.data.fame_votes.length>0)_o.notifySuccess(TEXTS[e].VOTED,{do_not_keep_previous:true});else _o.notifySuccess(TEXTS[e].CANCELED_VOTING,{do_not_keep_previous:true});$(".imcurrentleader").removeClass("imcurrentleader");$(".GGId").each((function(){if(l.data.fame_votes.includes(this.getAttribute("duty")||"")){this.classList.add("imcurrentleader")}}));gn()})).catch((()=>{_o.notifyError(TEXTS[e].ERROR_ANY)})).always((()=>{ct("famevote","middle");$("#vote_right_now").attr("wait",null)}))}+function(){function e(e){return function(){it("drink_screen");no(Pe(e))}}document.getElementById("takoyakimap")?.addEventListener("click",e("takoyaki"));document.getElementById("yscafemap")?.addEventListener("click",e("yscafe"));document.getElementById("syokudomap")?.addEventListener("click",e("syokudo"));document.getElementById("maidmap")?.addEventListener("click",e("maid"));document.getElementById("syasuderimap")?.addEventListener("click",e("syasuderi"))}();document.getElementById("user-name-input")?.addEventListener("keydown",bo);document.getElementById("user-name-input")?.addEventListener("input",To);document.getElementById("scan_stamp_trans")?.addEventListener("click",nn);document.getElementById("scan_stamp_growth")?.addEventListener("click",nn);document.getElementById("vote_right_now")?.addEventListener("click",Co);document.getElementById("evote_right_now")?.addEventListener("click",(()=>w.evote()));document.querySelectorAll("shishiji-fking-advertisement, #funny-closer").forEach((e=>e.addEventListener("click",Pt)));function Ui(e){const t=$($(e).children()[0]);const n=window.getComputedStyle(e).transform;const i=n.match(/matrix\((.+)\)/)?.[1]?.split(", ");const o={x:parseFloat(i?.[4]||"0"),y:parseFloat(i?.[5]||"0")};const s={width:parseFloat(t.css("min-width")?.replace("px","")),height:parseFloat(t.css("min-height")?.replace("px",""))};if(o.x+s.width/2<0||o.x-s.width/2>window.innerWidth||o.y+s.height/2<0||o.y-s.height/2>window.innerHeight)return true}function Yi(){for(const i of document.getElementsByClassName("mpob")){const o=i;const s={prev:o.getAttribute("prout"),now:false};const c=Ce(o);var e="";const r={x:(c.x-T.canvas.coords.x)*a,y:(c.y-T.canvas.coords.y)*a};var t=Le(o);const d=Ie(o);var n=Object.create(d);if(t=="dynamic"){if(a>O.object.dynamic_to_static.over)t="dynatic";if(a<O.object.dynamic_to_static.under)t="_dynatic"}switch(t){case"static":n.width=d.width*a;n.height=d.height*a;break;case"dynatic":n.width=d.width*(a/O.object.dynamic_to_static.over);n.height=d.height*(a/O.object.dynamic_to_static.over);break;case"_dynatic":break;n.width=d.width*(a/O.object.dynamic_to_static.under);n.height=d.height*(a/O.object.dynamic_to_static.under);break;case"dynamic":n.width=d.width;n.height=d.height;break}e+=`translate(${r.x}px, ${r.y}px)`;if(r.x+n.width<0||r.x-n.width>window.innerWidth||r.y+n.height<0||r.y-n.height>window.innerHeight){if(s.prev)continue;else o.setAttribute("prout","true")}else if(s.prev){o.removeAttribute("prout")}o.style.transform=e;$($(o).children()[0]).css("min-width",n.width+"px").css("min-height",n.height+"px")}}function qi(){const e=K[se]||[];for(const t of e){ei(t.coords,t.name)}}function Ji(e){const t=document.getElementById(Ee(ve,e));return t?t:null}function zi(e,t){const n=Ji(e)}function Vi(e){const t=Ji(e);if(t){const e=t.children[0];e.classList.add("mpob-clerdd");e.classList.remove("_","favoritE");e.classList.add("cleareD")}}function Ki(e,t){const n=Ji(e);if(t==0)t=1;if(n){const e=n.children[0];if(e.querySelectorAll(`.crowds-${t}`).length>0)return;e.querySelectorAll(".AUIHVP").forEach((e=>e.remove()));$(e).prepend(`<div class="AUIHVP kpls"><span class="crowds-${t}"></span></div>`)}}function Zi(e,t){const n=Ji(e);if(n){const e=n.children[0];if(e.querySelectorAll(".NJIvua").length>0)return;$(e).prepend(`<div class="NJIvua kpls"><span>${t}</span></div>`)}}function Qi(e){const t=Ji(e);if(t){const e=t.children[0];if(e.querySelectorAll(".AIGbbvwG").length>0)return;$(e).prepend(`<div class="AIGbbvwG kpls"><span></span></div>`)}}function eo(e){const t=Ji(e);if(t){const e=t.children[0];e.classList.remove("favoritE","cleareD");e.classList.add("_")}}function to(){const e=Math.ceil(l.data.completed_orgs.length/k*100);var t="";var n=false;if(e==100){t="#4CAF50"}else if(e>=75){t="#C0CA33"}else if(e>=50){t="#FDD835"}else if(e>=25){t="#F4511E"}else if(e>=0){t="#E53935"}if(l.data.completed_orgs.length>=13){n=true;t="#4CAF50";$("#oive_r").css("width","340px").css("height","60px").css("top","calc(100dvh - 70px)");$("#oive_h").css("padding","0 10px");$("#auyGAWW").text(`2階職員室前の面談室5 へおこしください！ペンを贈呈致します ${e}% (${l.data.completed_orgs.length}/${k})`)}else{$("#auyGAWW").css("color",t).text(`${e}% (${l.data.completed_orgs.length}/${k})`)}}function no(e){console.log(e);const t=ke.string(8);const n=e["object"]?.["floor"]??e["floor"];he.length=0;he.push(t);O.deny=true;function i(){const n=.25;const i=ge;const o=3e3/5;const s=li([window.innerWidth/2,window.innerHeight/2]);const c={zoom1:n<a?(n-a)/(o/3):0,zoom2:(i-n)/(o/3),pos:{x:((e["object"]?.["coordinate"]?.["x"]??e["x"])-s.x)/(o*(2/3)),y:((e["object"]?.["coordinate"]?.["y"]??e["y"])-s.y)/(o*(2/3))}};var r=0;function d(){r++;if(r>o){hi();O.deny=false;return}if(r<o/3)a+=c.zoom1;if(r>o*(3-1)/3)a+=c.zoom2;if(r<o*(2/3)){s.x+=c.pos.x;s.y+=c.pos.y}fi(s,a);he.includes(t)?setTimeout(d,5):void 0}d()}if(se==(e["object"]?.["floor"]??e["floor"])){i()}else{const e=oe[n];po(n,n,e).then(i)}}!function(){const e=document.getElementById("#place-selector".slice(1));$("#place-options").children().each((function(e,t){if(!this.textContent)return;const n=this.getAttribute("floor")||"";const i=this.textContent.replace(/ /g,"");if(n.length<1)return;function o(e){this.addEventListener("click",(function(t){t.preventDefault();const n=oe[e];if(se===e||n===undefined)return;po(e,i,n)}));return 0}o.apply(this,[n])}));$(e).on("click",(function(t){t.preventDefault();if(t.target?.classList.contains("fselector-btn")||t.target?.id=="psdummy"){ho.apply($(e),[ae.fselector.opened]);ae.fselector.opened=!ae.fselector.opened}}));return 0}();!function(){window.addEventListener("click",(function(e){const t=e.target;if($(t).hasClass("article-image")){const e=t.getAttribute("src");if(e)yo.popupMedia(e,"img",t)}}));"touchstart mousedown".split(" ").forEach((e=>{document.getElementById("user-stricter")?.addEventListener(e,(function(){if(oo.isfullyopened){ro()}}))}));document.getElementById("shishiji-overview")?.addEventListener("click",(function(e){if(e.pageY<20){document.getElementById("shishiji-overview")?.scrollTo({behavior:"smooth",top:0})}}));document.getElementById("dvd4")?.addEventListener("click",(function(e){e.preventDefault();w.share()}));document.getElementById("dvd1")?.addEventListener("click",(function(e){e.preventDefault();Z()}));document.getElementById("dvd2")?.addEventListener("click",(function(e){e.preventDefault();w.favorite()}));document.getElementById("dvd3")?.addEventListener("click",(function(e){e.preventDefault();w.vote()}));return 0}();!function(){const e=document.getElementById("shishiji-view");const i=document.getElementById("#place-selector".slice(1));function o(e){const t=e.target;if(O.deny)return true;if(t?.classList.contains("canvas_interactive")||t?.tagName.toLowerCase()==="canvas"){return false}return true}window.addEventListener("touchstart",(e=>{if(o(e))return;e.preventDefault();clearTimeout(R);if(ae.fselector.opened){ho.apply($(i),[true]);ae.fselector.opened=false}u();h(e);vi(e.touches);if(e.touches.length>=2)gi(e.touches)}),{passive:false});window.addEventListener("mousedown",(e=>{if(o(e))return;e.preventDefault();clearTimeout(R);if(ae.fselector.opened){ho.apply($(i),[true]);ae.fselector.opened=false}u();vi(e);window.addEventListener("mousemove",c,{passive:false})}),{passive:false});window.addEventListener("touchmove",(function(e){if(o(e))return;e.preventDefault();Ci(e)}),{passive:false});window.addEventListener("touchend",(e=>{if(o(e))return;e.preventDefault();h(e);s=false;t=[null,null];l(N.x,N.y)}),{passive:false});window.addEventListener("mouseup",r,{passive:false});window.addEventListener("wheel",a,{passive:true});window.addEventListener("mousewheel",a,{passive:true});function a(e){if(o(e))return;clearInterval(R);R=setTimeout((()=>{hi()}),d);if(Si.ctr)Li(e);else ki(e)}function c(t){if(O.deny)return;t.preventDefault();e.style.cursor="move";Array.from(document.getElementsByClassName("canvas_interactive")).forEach((e=>{e.style.cursor="move"}));s=true;Ii(t)}function r(n){n.preventDefault();t=[null,null];window.removeEventListener("mousemove",c);e.style.cursor="default";Array.from(document.getElementsByClassName("canvas_interactive")).forEach((e=>{e.style.cursor=e.getAttribute("dfcs")}));const i=N.x,o=N.y;if(s){s=false;return l(i,o)}}function l(e,t){function n(e){return e<0?-1:1}var i=e,o=t,s=N.a*n(e),a=N.a*n(t);if(isNaN(i)||isNaN(o))return 0;const c=setInterval((function(){var n={top:o/1e3,left:i/1e3};if(n.top*t<=0)n.top=0;if(n.left*e<=0)n.left=0;_i(n);i+=s;o+=a;if(i*e<=0&&o*t<=0){R=setTimeout((function(){hi()}),d);clearInterval(c);return}}),1);M=c;return 0}document.body.addEventListener("mousemove",(function(e){e.preventDefault();n=[e.clientX,e.clientY]}));function u(){s=false;clearInterval(M)}function h(e){U=0;Y=0;P=0;X=0;W=-1;B={x:-1,y:-1,distance:-1};H.real=[];if(e.touches.length<2)G=false}return 0}();!function(){!function(){return;const e=$("");function t(e){return Number(e.replace("px",""))}const n={width:t(e.css("width")),height:t(e.css("height")),margin:t(e.css("margin"))};$(window).on("resize",(function(i){var o=t(e.css("width"));var s=t(e.css("height"));var a=t(e.css("margin"));if(window.innerWidth<=o+a*2){e.css("width",window.innerWidth-a*2+"px");o=window.innerWidth-a*2}else{e.css("width",n.width+"px")}e.css("top",(window.innerHeight-(a*2+s))/2+"px").css("left",(window.innerWidth-(a*2+o))/2+"px")}));return 0}();return 0}();function ko(){i.width=window.innerWidth;i.height=window.innerHeight;i.style.width=i.width+"px";i.style.height=i.height+"px";T.canvas.width=i.width;T.canvas.height=i.height}!function(){const t=window.performance?.getEntriesByType("navigation")[0].type;const n={article:Xe(me.ARTICLE_ID),zoomRatio:Number(Xe(me.ZOOM_RATIO))||1,floor:Xe(me.FLOOR),coords:Xe(me.COORDS)?.split(",").map((e=>typeof e==="undefined"||isNaN(Number(e))?0:Number(e)))||[0,0],from:Xe(me.URL_FROM),lang:Ze(Xe(me.LANGUAGE)),jumpto:Xe(me.JUMPTO),_poor_coords:Xe(me.COORDS)?.split(",").map((e=>typeof e==="undefined"||isNaN(Number(e))?0:Number(e)))||[0,0]};if(n.coords.length!=2||n.coords.some((e=>{if(!e||isNaN(e))return true})))n.coords=[0,0];if(t=="reload"){switch(le){case de.DO_EVERYTHING:case de.INIT_FLOOR:n.floor=null;He(me.FLOOR);case de.INIT_COORDS:n.coords=[0,0];He(me.COORDS);case de.INIT_ZOOMRADIO:n.zoomRatio=1;He(me.ZOOM_RATIO);case de.CLOSE_ARTICLE:n.article=null;He(me.ARTICLE_ID);case de.DO_NOTHING:default:}}const i=Oe(TEXTS[e].LOADING,"first",true);He(me.URL_FROM);ko();fo();function o(e){const t=document.createElement("div");t.classList.add("fselc-cell","flxxt","realshadow");for(const[n,i]of Object.entries(e)){if(n=="initial_floor")continue;const e=t.cloneNode();e.textContent=i["so-called"]||n;e.setAttribute("floor",n);e.id="floor-"+n;e.addEventListener("click",(function(){if(se!=n&&!y.main_screen){he.length=0;po(n,e.textContent||"",oe[n],true);O.deny=false;$(".fselc-cell").removeClass("currentflr");$(this).addClass("currentflr")}}));$("#fsel-xxl").append(e)}}const s=$.when($.post(ajaxpath.mapdata),$.post(ajaxpath.mapobjs),$.post(ajaxpath.mappoints),Mt);function c(t,s,c){const r=t[0],d=s[0],u=c[0],h=[],f=[],m={"1F":"1階","2F":"2階","3F":"1階","4F":"4階",B1:"地下1階"};oe=r;V=d;K=u;o(t[0]);var p=r.initial_floor;var v=r[r.initial_floor];var g=Boolean(n.zoomRatio===1);if(n.floor&&Object.keys(r).includes(n.floor)){p=n.floor;v=r[n.floor]}if(n.from==pe.FROM_NAVIGATE){const e=Pe(n.article||"");p=e?.object.floor;v=r[p];h.push((()=>{fi(e?.object.coordinate||{x:(v.xrange+1)*v.tile_width/2,y:(v.yrange+1)*v.tile_height/2},a,true)}))}if(n.jumpto){var _=Pe(n.jumpto);p=_?.object.floor;v=r[p];n.article="";He(me.JUMPTO);He(me.ARTICLE_ID);h.push((()=>{fi(_?.object.coordinate||{x:(v.xrange+1)*v.tile_width/2,y:(v.yrange+1)*v.tile_height/2},ge,true);_o.notify("info",Ee(TEXTS[e].JUMPED_TO_MAP,_?.article.title))}))}se=p;T.width=v.tile_width*(v.xrange+1);T.height=v.tile_height*(v.yrange+1);+function(){var t=0;i.then((async()=>{if(!Ye("__reception")){Ue("__reception","done-"+(new Date).toString())}if(l.data.custom_data.headcount==0){Dt().then((()=>{if(yt("main_screen"))setTimeout((()=>{y.main_screen=O.deny=true;Et("main_screen")}),250)}))}await Ne(TEXTS[e].MAP_LOADED,t);yt("main_screen")&&l.data.custom_data.headcount!=0?f.push((()=>{y.main_screen=O.deny=true;Et("main_screen")})):0;f.forEach((e=>e()))}));$("#app-mount").show();if(n.article){if(n.from==pe.FROM_NAVIGATE)return;const t=Pe(n.article);var o=0;var s="description";if(t==null){if(n.from==pe.FROM_ARTICLE_SHARE){setTimeout((()=>{_o.notify("error",TEXTS[e].NOTIFICATION_SHARED_EVENT_NOT_FOUND,{duration:7500,discriminator:"share not found"})}),500)}He(me.ARTICLE_ID);return}if(n.from==pe.FROM_ARTICLE_SHARE){const n=t.object.coordinate;se=p=t.object.floor;v=oe[se];h.push((()=>fi(n,ge,true)));f.push((()=>{_o.notify("info",TEXTS[e].NOTIFICATION_SHARED_EVENT_FOUND,{duration:5e3,discriminator:"share found"})}));const i=Xe(me.SCROLL_POS),a=Xe(me.ART_TARGET);He(me.SCROLL_POS);He(me.ART_TARGET);if(i!=null||a){o=Number(i);if(a)s=a}}f.push((()=>{so();lo(t,true,o,s)}))}}();function w(){const e={width:(v.xrange+1)*v.tile_width,height:(v.yrange+1)*v.tile_height};const t=[document.body.clientWidth/e.width,document.body.clientHeight/e.height];T.canvas.coords={x:n.coords[0],y:n.coords[1]};if(n.zoomRatio>O.caps.ratio.max)n.zoomRatio=O.caps.ratio.max;if(n.zoomRatio<O.caps.ratio.min)n.zoomRatio=O.caps.ratio.min;a=n.zoomRatio||Math.min(...t);_i({left:0,top:0});Xi(p,V);Fi();hi();mo();if(g||n._poor_coords.some((e=>e===0))){a=Math.min(...t);fi({x:(v.xrange+1)*v.tile_width/2,y:(v.yrange+1)*v.tile_height/2},a,true)}h.forEach((e=>e()))}$("#floor-"+se).addClass("currentflr");mi(v,{over:"",under:m[se]},w);Be(me.FLOOR,se);fo()}s.done(n.floor?c:c);return 0}();window.addEventListener("resize",(function(e){e.preventDefault();ko();_i({top:0,left:0});window.scroll({top:0,behavior:"instant"})}),{passive:false});window.addEventListener("touchstart",(function(e){if(e.target.classList.contains("canvas_interactive")){e.target.classList.add("interactive_trans")}}),{passive:true});window.addEventListener("touchend",(function(e){Array.from(document.getElementsByClassName("interactive_trans")).forEach((e=>e.classList.remove("interactive_trans")))}),{passive:true});document.oncontextmenu=()=>false;if("serviceWorker"in navigator){navigator.serviceWorker.register("/src/assets/service-worker/poverty.js").then((function(e){})).catch((function(e){}))}setInterval((async function(){for(const e of l.pending_collects){xt(e.name,e.count)}l.pending_collects.length=0}),1e4);window.addEventListener("load",(function(e){}));return 0})();